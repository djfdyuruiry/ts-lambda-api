<!DOCTYPE html><html class="default" lang="en" data-base="../"><head><meta charset="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>pipeline | ts-lambda-api - v2.5.1</title><meta name="description" content="Documentation for ts-lambda-api"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="../assets/style.css"/><link rel="stylesheet" href="../assets/highlight.css"/><script defer src="../assets/main.js"></script><script async src="../assets/icons.js" id="tsd-icons-script"></script><script async src="../assets/search.js" id="tsd-search-script"></script><script async src="../assets/navigation.js" id="tsd-nav-script"></script><script async src="../assets/hierarchy.js" id="tsd-hierarchy-script"></script></head><body><script>document.documentElement.dataset.theme = localStorage.getItem("tsd-theme") || "os";document.body.style.display="none";setTimeout(() => window.app?app.showPage():document.body.style.removeProperty("display"),500)</script><header class="tsd-page-toolbar"><div class="tsd-toolbar-contents container"><a href="../index.html" class="title">ts-lambda-api - v2.5.1</a><div id="tsd-toolbar-links"></div><button id="tsd-search-trigger" class="tsd-widget" aria-label="Search"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-search"></use></svg></button><dialog id="tsd-search" aria-label="Search"><input role="combobox" id="tsd-search-input" aria-controls="tsd-search-results" aria-autocomplete="list" aria-expanded="true" autocapitalize="off" autocomplete="off" placeholder="Search the docs" maxLength="100"/><ul role="listbox" id="tsd-search-results"></ul><div id="tsd-search-status" aria-live="polite" aria-atomic="true"><div>Preparing search index...</div></div></dialog><a href="#" class="tsd-widget menu" id="tsd-toolbar-menu-trigger" data-toggle="menu" aria-label="Menu"><svg width="16" height="16" viewBox="0 0 16 16" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-menu"></use></svg></a></div></header><div class="container container-main"><div class="col-content"><div class="tsd-page-title"><ul class="tsd-breadcrumb" aria-label="Breadcrumb"><li><a href="../modules/_internal_.html">&lt;internal&gt;</a></li><li><a href="../modules/_internal_.Stream.html">Stream</a></li><li><a href="" aria-current="page">pipeline</a></li></ul><h1>Function pipeline</h1></div><section class="tsd-panel"><ul class="tsd-signatures tsd-is-external"><li class="tsd-is-external"><div class="tsd-signature tsd-anchor-link" id="pipeline"><span class="tsd-kind-call-signature">pipeline</span><span class="tsd-signature-symbol">&lt;</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea">A</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a> <span class="tsd-signature-keyword">extends</span><br/>    <br/>            <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><br/>                <span class="tsd-signature-type">string</span><br/>                <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>                <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span><br/>            <span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">source</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea">A</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">destination</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">callback</span><span class="tsd-signature-symbol">:</span> <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><a href="#pipeline" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>A module method to pipe between streams and generators forwarding errors and
properly cleaning up and provide a callback when the pipeline is complete.</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">zlib</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:zlib&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Use the pipeline API to easily pipe a series of streams</span><br/><span class="hl-8">// together and get notified when the pipeline is fully done.</span><br/><br/><span class="hl-8">// A pipeline to gzip a potentially huge tar file efficiently:</span><br/><br/><span class="hl-0">pipeline</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">zlib</span><span class="hl-1">.</span><span class="hl-0">createGzip</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createWriteStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar.gz&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline failed.&#39;</span><span class="hl-1">, </span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline succeeded.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The <code>pipeline</code> API provides a <a href="https://nodejs.org/docs/latest-v24.x/api/stream.html#streampipelinesource-transforms-destination-options"><code>promise version</code></a>.</p>
<p><code>stream.pipeline()</code> will call <code>stream.destroy(err)</code> on all streams except:</p>
<ul>
<li><code>Readable</code> streams which have emitted <code>'end'</code> or <code>'close'</code>.</li>
<li><code>Writable</code> streams which have emitted <code>'finish'</code> or <code>'close'</code>.</li>
</ul>
<p><code>stream.pipeline()</code> leaves dangling event listeners on the streams
after the <code>callback</code> has been invoked. In the case of reuse of streams after
failure, this can cause event listener leaks and swallowed errors. If the last
stream is readable, dangling event listeners will be removed so that the last
stream can be consumed later.</p>
<p><code>stream.pipeline()</code> closes all the streams when an error is raised.
The <code>IncomingRequest</code> usage with <code>pipeline</code> could lead to an unexpected behavior
once it would destroy the socket without sending the expected response.
See the example below:</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">http</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:http&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-6">http</span><span class="hl-1">.</span><span class="hl-0">createServer</span><span class="hl-1">((</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">fileStream</span><span class="hl-1"> = </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;./fileNotExist.txt&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">pipeline</span><span class="hl-1">(</span><span class="hl-6">fileStream</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">, (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">); </span><span class="hl-8">// No such file</span><br/><span class="hl-1">      </span><span class="hl-8">// this message can&#39;t be sent once `pipeline` already destroyed the socket</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">(</span><span class="hl-2">&#39;error!!!&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div><section class="tsd-panel"><h4>Type Parameters</h4><ul class="tsd-type-parameter-list"><li><span id="pipelinea"><span class="tsd-kind-type-parameter">A</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelineb"><span class="tsd-kind-type-parameter">B</span> <span class="tsd-signature-keyword">extends</span> <br/>    <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li></ul></section><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">source</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea">A</a></span></li><li><span><span class="tsd-kind-parameter">destination</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a></span></li><li><span><span class="tsd-kind-parameter">callback</span>: <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a><span class="tsd-signature-symbol">&gt;</span></span><div class="tsd-comment tsd-typography"><p>Called when the pipeline is fully done.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a></h4><div class="tsd-comment tsd-typography"><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since">Since<a href="#since" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>v10.0.0</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in node_modules/@types/node/stream.d.ts:1499</li></ul></aside></div></li><li class="tsd-is-external"><div class="tsd-signature tsd-anchor-link" id="pipeline-1"><span class="tsd-kind-call-signature">pipeline</span><span class="tsd-signature-symbol">&lt;</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-1">A</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1">T1</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-1">A</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a> <span class="tsd-signature-keyword">extends</span><br/>    <br/>            <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><br/>                <span class="tsd-signature-type">string</span><br/>                <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>                <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span><br/>            <span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">source</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-1">A</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform1</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1">T1</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">destination</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">callback</span><span class="tsd-signature-symbol">:</span> <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><a href="#pipeline-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>A module method to pipe between streams and generators forwarding errors and
properly cleaning up and provide a callback when the pipeline is complete.</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">zlib</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:zlib&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Use the pipeline API to easily pipe a series of streams</span><br/><span class="hl-8">// together and get notified when the pipeline is fully done.</span><br/><br/><span class="hl-8">// A pipeline to gzip a potentially huge tar file efficiently:</span><br/><br/><span class="hl-0">pipeline</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">zlib</span><span class="hl-1">.</span><span class="hl-0">createGzip</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createWriteStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar.gz&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline failed.&#39;</span><span class="hl-1">, </span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline succeeded.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The <code>pipeline</code> API provides a <a href="https://nodejs.org/docs/latest-v24.x/api/stream.html#streampipelinesource-transforms-destination-options"><code>promise version</code></a>.</p>
<p><code>stream.pipeline()</code> will call <code>stream.destroy(err)</code> on all streams except:</p>
<ul>
<li><code>Readable</code> streams which have emitted <code>'end'</code> or <code>'close'</code>.</li>
<li><code>Writable</code> streams which have emitted <code>'finish'</code> or <code>'close'</code>.</li>
</ul>
<p><code>stream.pipeline()</code> leaves dangling event listeners on the streams
after the <code>callback</code> has been invoked. In the case of reuse of streams after
failure, this can cause event listener leaks and swallowed errors. If the last
stream is readable, dangling event listeners will be removed so that the last
stream can be consumed later.</p>
<p><code>stream.pipeline()</code> closes all the streams when an error is raised.
The <code>IncomingRequest</code> usage with <code>pipeline</code> could lead to an unexpected behavior
once it would destroy the socket without sending the expected response.
See the example below:</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">http</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:http&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-6">http</span><span class="hl-1">.</span><span class="hl-0">createServer</span><span class="hl-1">((</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">fileStream</span><span class="hl-1"> = </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;./fileNotExist.txt&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">pipeline</span><span class="hl-1">(</span><span class="hl-6">fileStream</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">, (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">); </span><span class="hl-8">// No such file</span><br/><span class="hl-1">      </span><span class="hl-8">// this message can&#39;t be sent once `pipeline` already destroyed the socket</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">(</span><span class="hl-2">&#39;error!!!&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div><section class="tsd-panel"><h4>Type Parameters</h4><ul class="tsd-type-parameter-list"><li><span id="pipelinea-1"><span class="tsd-kind-type-parameter">A</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet1"><span class="tsd-kind-type-parameter">T1</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-1">A</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelineb-1"><span class="tsd-kind-type-parameter">B</span> <span class="tsd-signature-keyword">extends</span> <br/>    <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li></ul></section><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">source</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-1">A</a></span></li><li><span><span class="tsd-kind-parameter">transform1</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1">T1</a></span></li><li><span><span class="tsd-kind-parameter">destination</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a></span></li><li><span><span class="tsd-kind-parameter">callback</span>: <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a><span class="tsd-signature-symbol">&gt;</span></span><div class="tsd-comment tsd-typography"><p>Called when the pipeline is fully done.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-1">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a></h4><div class="tsd-comment tsd-typography"><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-1">Since<a href="#since-1" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>v10.0.0</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in node_modules/@types/node/stream.d.ts:1504</li></ul></aside></div></li><li class="tsd-is-external"><div class="tsd-signature tsd-anchor-link" id="pipeline-2"><span class="tsd-kind-call-signature">pipeline</span><span class="tsd-signature-symbol">&lt;</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-2">A</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-1">T1</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-2">A</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2">T2</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-1">T1</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a> <span class="tsd-signature-keyword">extends</span><br/>    <br/>            <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><br/>                <span class="tsd-signature-type">string</span><br/>                <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>                <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span><br/>            <span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">source</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-2">A</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform1</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-1">T1</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform2</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2">T2</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">destination</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">callback</span><span class="tsd-signature-symbol">:</span> <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><a href="#pipeline-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>A module method to pipe between streams and generators forwarding errors and
properly cleaning up and provide a callback when the pipeline is complete.</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">zlib</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:zlib&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Use the pipeline API to easily pipe a series of streams</span><br/><span class="hl-8">// together and get notified when the pipeline is fully done.</span><br/><br/><span class="hl-8">// A pipeline to gzip a potentially huge tar file efficiently:</span><br/><br/><span class="hl-0">pipeline</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">zlib</span><span class="hl-1">.</span><span class="hl-0">createGzip</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createWriteStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar.gz&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline failed.&#39;</span><span class="hl-1">, </span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline succeeded.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The <code>pipeline</code> API provides a <a href="https://nodejs.org/docs/latest-v24.x/api/stream.html#streampipelinesource-transforms-destination-options"><code>promise version</code></a>.</p>
<p><code>stream.pipeline()</code> will call <code>stream.destroy(err)</code> on all streams except:</p>
<ul>
<li><code>Readable</code> streams which have emitted <code>'end'</code> or <code>'close'</code>.</li>
<li><code>Writable</code> streams which have emitted <code>'finish'</code> or <code>'close'</code>.</li>
</ul>
<p><code>stream.pipeline()</code> leaves dangling event listeners on the streams
after the <code>callback</code> has been invoked. In the case of reuse of streams after
failure, this can cause event listener leaks and swallowed errors. If the last
stream is readable, dangling event listeners will be removed so that the last
stream can be consumed later.</p>
<p><code>stream.pipeline()</code> closes all the streams when an error is raised.
The <code>IncomingRequest</code> usage with <code>pipeline</code> could lead to an unexpected behavior
once it would destroy the socket without sending the expected response.
See the example below:</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">http</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:http&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-6">http</span><span class="hl-1">.</span><span class="hl-0">createServer</span><span class="hl-1">((</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">fileStream</span><span class="hl-1"> = </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;./fileNotExist.txt&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">pipeline</span><span class="hl-1">(</span><span class="hl-6">fileStream</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">, (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">); </span><span class="hl-8">// No such file</span><br/><span class="hl-1">      </span><span class="hl-8">// this message can&#39;t be sent once `pipeline` already destroyed the socket</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">(</span><span class="hl-2">&#39;error!!!&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div><section class="tsd-panel"><h4>Type Parameters</h4><ul class="tsd-type-parameter-list"><li><span id="pipelinea-2"><span class="tsd-kind-type-parameter">A</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet1-1"><span class="tsd-kind-type-parameter">T1</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-2">A</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet2"><span class="tsd-kind-type-parameter">T2</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-1">T1</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelineb-2"><span class="tsd-kind-type-parameter">B</span> <span class="tsd-signature-keyword">extends</span> <br/>    <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li></ul></section><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">source</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-2">A</a></span></li><li><span><span class="tsd-kind-parameter">transform1</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-1">T1</a></span></li><li><span><span class="tsd-kind-parameter">transform2</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2">T2</a></span></li><li><span><span class="tsd-kind-parameter">destination</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a></span></li><li><span><span class="tsd-kind-parameter">callback</span>: <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a><span class="tsd-signature-symbol">&gt;</span></span><div class="tsd-comment tsd-typography"><p>Called when the pipeline is fully done.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-2">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a></h4><div class="tsd-comment tsd-typography"><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-2">Since<a href="#since-2" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>v10.0.0</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in node_modules/@types/node/stream.d.ts:1514</li></ul></aside></div></li><li class="tsd-is-external"><div class="tsd-signature tsd-anchor-link" id="pipeline-3"><span class="tsd-kind-call-signature">pipeline</span><span class="tsd-signature-symbol">&lt;</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-3">A</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-2">T1</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-3">A</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-1">T2</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-2">T1</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet3">T3</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-1">T2</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a> <span class="tsd-signature-keyword">extends</span><br/>    <br/>            <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><br/>                <span class="tsd-signature-type">string</span><br/>                <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>                <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span><br/>            <span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">source</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-3">A</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform1</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-2">T1</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform2</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-1">T2</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform3</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet3">T3</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">destination</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">callback</span><span class="tsd-signature-symbol">:</span> <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><a href="#pipeline-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>A module method to pipe between streams and generators forwarding errors and
properly cleaning up and provide a callback when the pipeline is complete.</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">zlib</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:zlib&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Use the pipeline API to easily pipe a series of streams</span><br/><span class="hl-8">// together and get notified when the pipeline is fully done.</span><br/><br/><span class="hl-8">// A pipeline to gzip a potentially huge tar file efficiently:</span><br/><br/><span class="hl-0">pipeline</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">zlib</span><span class="hl-1">.</span><span class="hl-0">createGzip</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createWriteStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar.gz&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline failed.&#39;</span><span class="hl-1">, </span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline succeeded.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The <code>pipeline</code> API provides a <a href="https://nodejs.org/docs/latest-v24.x/api/stream.html#streampipelinesource-transforms-destination-options"><code>promise version</code></a>.</p>
<p><code>stream.pipeline()</code> will call <code>stream.destroy(err)</code> on all streams except:</p>
<ul>
<li><code>Readable</code> streams which have emitted <code>'end'</code> or <code>'close'</code>.</li>
<li><code>Writable</code> streams which have emitted <code>'finish'</code> or <code>'close'</code>.</li>
</ul>
<p><code>stream.pipeline()</code> leaves dangling event listeners on the streams
after the <code>callback</code> has been invoked. In the case of reuse of streams after
failure, this can cause event listener leaks and swallowed errors. If the last
stream is readable, dangling event listeners will be removed so that the last
stream can be consumed later.</p>
<p><code>stream.pipeline()</code> closes all the streams when an error is raised.
The <code>IncomingRequest</code> usage with <code>pipeline</code> could lead to an unexpected behavior
once it would destroy the socket without sending the expected response.
See the example below:</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">http</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:http&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-6">http</span><span class="hl-1">.</span><span class="hl-0">createServer</span><span class="hl-1">((</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">fileStream</span><span class="hl-1"> = </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;./fileNotExist.txt&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">pipeline</span><span class="hl-1">(</span><span class="hl-6">fileStream</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">, (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">); </span><span class="hl-8">// No such file</span><br/><span class="hl-1">      </span><span class="hl-8">// this message can&#39;t be sent once `pipeline` already destroyed the socket</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">(</span><span class="hl-2">&#39;error!!!&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div><section class="tsd-panel"><h4>Type Parameters</h4><ul class="tsd-type-parameter-list"><li><span id="pipelinea-3"><span class="tsd-kind-type-parameter">A</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet1-2"><span class="tsd-kind-type-parameter">T1</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-3">A</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet2-1"><span class="tsd-kind-type-parameter">T2</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-2">T1</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet3"><span class="tsd-kind-type-parameter">T3</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-1">T2</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelineb-3"><span class="tsd-kind-type-parameter">B</span> <span class="tsd-signature-keyword">extends</span> <br/>    <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li></ul></section><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">source</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-3">A</a></span></li><li><span><span class="tsd-kind-parameter">transform1</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-2">T1</a></span></li><li><span><span class="tsd-kind-parameter">transform2</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-1">T2</a></span></li><li><span><span class="tsd-kind-parameter">transform3</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet3">T3</a></span></li><li><span><span class="tsd-kind-parameter">destination</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a></span></li><li><span><span class="tsd-kind-parameter">callback</span>: <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a><span class="tsd-signature-symbol">&gt;</span></span><div class="tsd-comment tsd-typography"><p>Called when the pipeline is fully done.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-3">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a></h4><div class="tsd-comment tsd-typography"><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-3">Since<a href="#since-3" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>v10.0.0</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in node_modules/@types/node/stream.d.ts:1526</li></ul></aside></div></li><li class="tsd-is-external"><div class="tsd-signature tsd-anchor-link" id="pipeline-4"><span class="tsd-kind-call-signature">pipeline</span><span class="tsd-signature-symbol">&lt;</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-4">A</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-3">T1</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-4">A</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-2">T2</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-3">T1</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet3-1">T3</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-2">T2</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet4">T4</a> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet3-1">T3</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>    <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a> <span class="tsd-signature-keyword">extends</span><br/>    <br/>            <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><br/>                <span class="tsd-signature-type">string</span><br/>                <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/>                <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span><br/>            <span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>            <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">source</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-4">A</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform1</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-3">T1</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform2</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-2">T2</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform3</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet3-1">T3</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">transform4</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet4">T4</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">destination</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">callback</span><span class="tsd-signature-symbol">:</span> <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><a href="#pipeline-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>A module method to pipe between streams and generators forwarding errors and
properly cleaning up and provide a callback when the pipeline is complete.</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">zlib</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:zlib&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Use the pipeline API to easily pipe a series of streams</span><br/><span class="hl-8">// together and get notified when the pipeline is fully done.</span><br/><br/><span class="hl-8">// A pipeline to gzip a potentially huge tar file efficiently:</span><br/><br/><span class="hl-0">pipeline</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">zlib</span><span class="hl-1">.</span><span class="hl-0">createGzip</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createWriteStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar.gz&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline failed.&#39;</span><span class="hl-1">, </span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline succeeded.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The <code>pipeline</code> API provides a <a href="https://nodejs.org/docs/latest-v24.x/api/stream.html#streampipelinesource-transforms-destination-options"><code>promise version</code></a>.</p>
<p><code>stream.pipeline()</code> will call <code>stream.destroy(err)</code> on all streams except:</p>
<ul>
<li><code>Readable</code> streams which have emitted <code>'end'</code> or <code>'close'</code>.</li>
<li><code>Writable</code> streams which have emitted <code>'finish'</code> or <code>'close'</code>.</li>
</ul>
<p><code>stream.pipeline()</code> leaves dangling event listeners on the streams
after the <code>callback</code> has been invoked. In the case of reuse of streams after
failure, this can cause event listener leaks and swallowed errors. If the last
stream is readable, dangling event listeners will be removed so that the last
stream can be consumed later.</p>
<p><code>stream.pipeline()</code> closes all the streams when an error is raised.
The <code>IncomingRequest</code> usage with <code>pipeline</code> could lead to an unexpected behavior
once it would destroy the socket without sending the expected response.
See the example below:</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">http</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:http&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-6">http</span><span class="hl-1">.</span><span class="hl-0">createServer</span><span class="hl-1">((</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">fileStream</span><span class="hl-1"> = </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;./fileNotExist.txt&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">pipeline</span><span class="hl-1">(</span><span class="hl-6">fileStream</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">, (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">); </span><span class="hl-8">// No such file</span><br/><span class="hl-1">      </span><span class="hl-8">// this message can&#39;t be sent once `pipeline` already destroyed the socket</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">(</span><span class="hl-2">&#39;error!!!&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div><section class="tsd-panel"><h4>Type Parameters</h4><ul class="tsd-type-parameter-list"><li><span id="pipelinea-4"><span class="tsd-kind-type-parameter">A</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineSource.html" class="tsd-signature-type tsd-kind-type-alias">PipelineSource</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet1-3"><span class="tsd-kind-type-parameter">T1</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-4">A</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet2-2"><span class="tsd-kind-type-parameter">T2</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-3">T1</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet3-1"><span class="tsd-kind-type-parameter">T3</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-2">T2</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelinet4"><span class="tsd-kind-type-parameter">T4</span> <span class="tsd-signature-keyword">extends</span> <a href="../types/_internal_.Stream.PipelineTransform.html" class="tsd-signature-type tsd-kind-type-alias">PipelineTransform</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet3-1">T3</a><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li><li><span id="pipelineb-4"><span class="tsd-kind-type-parameter">B</span> <span class="tsd-signature-keyword">extends</span> <br/>    <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">string</span> <span class="tsd-signature-symbol">|</span> <span class="tsd-signature-type">Buffer</span><span class="tsd-signature-symbol">&lt;</span><a href="../types/_internal_.ArrayBufferLike.html" class="tsd-signature-type tsd-kind-type-alias">ArrayBufferLike</a><span class="tsd-signature-symbol">&gt;</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationIterableFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationIterableFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span><br/>    <span class="tsd-signature-symbol">|</span> <a href="../types/_internal_.Stream.PipelineDestinationPromiseFunction.html" class="tsd-signature-type tsd-kind-type-alias">PipelineDestinationPromiseFunction</a><span class="tsd-signature-symbol">&lt;</span><span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">,</span> <span class="tsd-signature-type">any</span><span class="tsd-signature-symbol">&gt;</span></span></li></ul></section><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">source</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinea-4">A</a></span></li><li><span><span class="tsd-kind-parameter">transform1</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet1-3">T1</a></span></li><li><span><span class="tsd-kind-parameter">transform2</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet2-2">T2</a></span></li><li><span><span class="tsd-kind-parameter">transform3</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet3-1">T3</a></span></li><li><span><span class="tsd-kind-parameter">transform4</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelinet4">T4</a></span></li><li><span><span class="tsd-kind-parameter">destination</span>: <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a></span></li><li><span><span class="tsd-kind-parameter">callback</span>: <a href="../types/_internal_.Stream.PipelineCallback.html" class="tsd-signature-type tsd-kind-type-alias">PipelineCallback</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a><span class="tsd-signature-symbol">&gt;</span></span><div class="tsd-comment tsd-typography"><p>Called when the pipeline is fully done.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a> <span class="tsd-signature-keyword">extends</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">?</span> <a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a><span class="tsd-signature-symbol">&lt;</span><a class="tsd-signature-type tsd-kind-type-parameter" href="#pipelineb-4">B</a><span class="tsd-signature-symbol">&gt;</span> <span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a></h4><div class="tsd-comment tsd-typography"><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-4">Since<a href="#since-4" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>v10.0.0</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in node_modules/@types/node/stream.d.ts:1540</li></ul></aside></div></li><li class="tsd-is-external"><div class="tsd-signature tsd-anchor-link" id="pipeline-5"><span class="tsd-kind-call-signature">pipeline</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">streams</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-keyword">readonly</span> (<a href="../interfaces/_internal_.ReadableStream.html" class="tsd-signature-type tsd-kind-interface">ReadableStream</a> <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.ReadWriteStream.html" class="tsd-signature-type tsd-kind-interface">ReadWriteStream</a>)<span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">callback</span><span class="tsd-signature-symbol">:</span> <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">err</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.ErrnoException.html" class="tsd-signature-type tsd-kind-interface">ErrnoException</a><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">void</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><a href="#pipeline-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>A module method to pipe between streams and generators forwarding errors and
properly cleaning up and provide a callback when the pipeline is complete.</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">zlib</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:zlib&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Use the pipeline API to easily pipe a series of streams</span><br/><span class="hl-8">// together and get notified when the pipeline is fully done.</span><br/><br/><span class="hl-8">// A pipeline to gzip a potentially huge tar file efficiently:</span><br/><br/><span class="hl-0">pipeline</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">zlib</span><span class="hl-1">.</span><span class="hl-0">createGzip</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createWriteStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar.gz&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline failed.&#39;</span><span class="hl-1">, </span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline succeeded.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The <code>pipeline</code> API provides a <a href="https://nodejs.org/docs/latest-v24.x/api/stream.html#streampipelinesource-transforms-destination-options"><code>promise version</code></a>.</p>
<p><code>stream.pipeline()</code> will call <code>stream.destroy(err)</code> on all streams except:</p>
<ul>
<li><code>Readable</code> streams which have emitted <code>'end'</code> or <code>'close'</code>.</li>
<li><code>Writable</code> streams which have emitted <code>'finish'</code> or <code>'close'</code>.</li>
</ul>
<p><code>stream.pipeline()</code> leaves dangling event listeners on the streams
after the <code>callback</code> has been invoked. In the case of reuse of streams after
failure, this can cause event listener leaks and swallowed errors. If the last
stream is readable, dangling event listeners will be removed so that the last
stream can be consumed later.</p>
<p><code>stream.pipeline()</code> closes all the streams when an error is raised.
The <code>IncomingRequest</code> usage with <code>pipeline</code> could lead to an unexpected behavior
once it would destroy the socket without sending the expected response.
See the example below:</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">http</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:http&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-6">http</span><span class="hl-1">.</span><span class="hl-0">createServer</span><span class="hl-1">((</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">fileStream</span><span class="hl-1"> = </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;./fileNotExist.txt&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">pipeline</span><span class="hl-1">(</span><span class="hl-6">fileStream</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">, (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">); </span><span class="hl-8">// No such file</span><br/><span class="hl-1">      </span><span class="hl-8">// this message can&#39;t be sent once `pipeline` already destroyed the socket</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">(</span><span class="hl-2">&#39;error!!!&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">streams</span>: <span class="tsd-signature-keyword">readonly</span> (<a href="../interfaces/_internal_.ReadableStream.html" class="tsd-signature-type tsd-kind-interface">ReadableStream</a> <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.ReadWriteStream.html" class="tsd-signature-type tsd-kind-interface">ReadWriteStream</a>)<span class="tsd-signature-symbol">[]</span></span></li><li><span><span class="tsd-kind-parameter">callback</span>: <span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">err</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.ErrnoException.html" class="tsd-signature-type tsd-kind-interface">ErrnoException</a><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">void</span></span><div class="tsd-comment tsd-typography"><p>Called when the pipeline is fully done.</p>
</div><div class="tsd-comment tsd-typography"></div></li></ul></div><h4 class="tsd-returns-title">Returns <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a></h4><div class="tsd-comment tsd-typography"><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-5">Since<a href="#since-5" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>v10.0.0</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in node_modules/@types/node/stream.d.ts:1556</li></ul></aside></div></li><li class="tsd-is-external"><div class="tsd-signature tsd-anchor-link" id="pipeline-6"><span class="tsd-kind-call-signature">pipeline</span><span class="tsd-signature-symbol">(</span><br/>    <span class="tsd-kind-parameter">stream1</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.ReadableStream.html" class="tsd-signature-type tsd-kind-interface">ReadableStream</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-kind-parameter">stream2</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.ReadWriteStream.html" class="tsd-signature-type tsd-kind-interface">ReadWriteStream</a><span class="tsd-signature-symbol">,</span><br/>    <span class="tsd-signature-symbol">...</span><span class="tsd-kind-parameter">streams</span><span class="tsd-signature-symbol">:</span> (<br/>        <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><br/>        <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.ReadWriteStream.html" class="tsd-signature-type tsd-kind-interface">ReadWriteStream</a><br/>        <span class="tsd-signature-symbol">|</span> (<span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">err</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.ErrnoException.html" class="tsd-signature-type tsd-kind-interface">ErrnoException</a><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">void</span>)<br/>    )<span class="tsd-signature-symbol">[]</span><span class="tsd-signature-symbol">,</span><br/><span class="tsd-signature-symbol">)</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a><a href="#pipeline-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></div><div class="tsd-description"><div class="tsd-comment tsd-typography"><p>A module method to pipe between streams and generators forwarding errors and
properly cleaning up and provide a callback when the pipeline is complete.</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">zlib</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:zlib&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-8">// Use the pipeline API to easily pipe a series of streams</span><br/><span class="hl-8">// together and get notified when the pipeline is fully done.</span><br/><br/><span class="hl-8">// A pipeline to gzip a potentially huge tar file efficiently:</span><br/><br/><span class="hl-0">pipeline</span><span class="hl-1">(</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  </span><span class="hl-6">zlib</span><span class="hl-1">.</span><span class="hl-0">createGzip</span><span class="hl-1">(),</span><br/><span class="hl-1">  </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createWriteStream</span><span class="hl-1">(</span><span class="hl-2">&#39;archive.tar.gz&#39;</span><span class="hl-1">),</span><br/><span class="hl-1">  (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">error</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline failed.&#39;</span><span class="hl-1">, </span><span class="hl-6">err</span><span class="hl-1">);</span><br/><span class="hl-1">    } </span><span class="hl-5">else</span><span class="hl-1"> {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-2">&#39;Pipeline succeeded.&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  },</span><br/><span class="hl-1">);</span>
</code><button type="button">Copy</button></pre>

<p>The <code>pipeline</code> API provides a <a href="https://nodejs.org/docs/latest-v24.x/api/stream.html#streampipelinesource-transforms-destination-options"><code>promise version</code></a>.</p>
<p><code>stream.pipeline()</code> will call <code>stream.destroy(err)</code> on all streams except:</p>
<ul>
<li><code>Readable</code> streams which have emitted <code>'end'</code> or <code>'close'</code>.</li>
<li><code>Writable</code> streams which have emitted <code>'finish'</code> or <code>'close'</code>.</li>
</ul>
<p><code>stream.pipeline()</code> leaves dangling event listeners on the streams
after the <code>callback</code> has been invoked. In the case of reuse of streams after
failure, this can cause event listener leaks and swallowed errors. If the last
stream is readable, dangling event listeners will be removed so that the last
stream can be consumed later.</p>
<p><code>stream.pipeline()</code> closes all the streams when an error is raised.
The <code>IncomingRequest</code> usage with <code>pipeline</code> could lead to an unexpected behavior
once it would destroy the socket without sending the expected response.
See the example below:</p>
<pre><code class="js"><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">fs</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:fs&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> </span><span class="hl-6">http</span><span class="hl-1"> </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:http&#39;</span><span class="hl-1">;</span><br/><span class="hl-5">import</span><span class="hl-1"> { </span><span class="hl-6">pipeline</span><span class="hl-1"> } </span><span class="hl-5">from</span><span class="hl-1"> </span><span class="hl-2">&#39;node:stream&#39;</span><span class="hl-1">;</span><br/><br/><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">server</span><span class="hl-1"> = </span><span class="hl-6">http</span><span class="hl-1">.</span><span class="hl-0">createServer</span><span class="hl-1">((</span><span class="hl-6">req</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">  </span><span class="hl-3">const</span><span class="hl-1"> </span><span class="hl-7">fileStream</span><span class="hl-1"> = </span><span class="hl-6">fs</span><span class="hl-1">.</span><span class="hl-0">createReadStream</span><span class="hl-1">(</span><span class="hl-2">&#39;./fileNotExist.txt&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">  </span><span class="hl-0">pipeline</span><span class="hl-1">(</span><span class="hl-6">fileStream</span><span class="hl-1">, </span><span class="hl-6">res</span><span class="hl-1">, (</span><span class="hl-6">err</span><span class="hl-1">) </span><span class="hl-3">=&gt;</span><span class="hl-1"> {</span><br/><span class="hl-1">    </span><span class="hl-5">if</span><span class="hl-1"> (</span><span class="hl-6">err</span><span class="hl-1">) {</span><br/><span class="hl-1">      </span><span class="hl-6">console</span><span class="hl-1">.</span><span class="hl-0">log</span><span class="hl-1">(</span><span class="hl-6">err</span><span class="hl-1">); </span><span class="hl-8">// No such file</span><br/><span class="hl-1">      </span><span class="hl-8">// this message can&#39;t be sent once `pipeline` already destroyed the socket</span><br/><span class="hl-1">      </span><span class="hl-5">return</span><span class="hl-1"> </span><span class="hl-6">res</span><span class="hl-1">.</span><span class="hl-0">end</span><span class="hl-1">(</span><span class="hl-2">&#39;error!!!&#39;</span><span class="hl-1">);</span><br/><span class="hl-1">    }</span><br/><span class="hl-1">  });</span><br/><span class="hl-1">});</span>
</code><button type="button">Copy</button></pre>

</div><div class="tsd-parameters"><h4 class="tsd-parameters-title">Parameters</h4><ul class="tsd-parameter-list"><li><span><span class="tsd-kind-parameter">stream1</span>: <a href="../interfaces/_internal_.ReadableStream.html" class="tsd-signature-type tsd-kind-interface">ReadableStream</a></span></li><li><span><span class="tsd-kind-parameter">stream2</span>: <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.ReadWriteStream.html" class="tsd-signature-type tsd-kind-interface">ReadWriteStream</a></span></li><li><span><span class="tsd-signature-symbol">...</span><span class="tsd-kind-parameter">streams</span>: (<a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a> <span class="tsd-signature-symbol">|</span> <a href="../interfaces/_internal_.ReadWriteStream.html" class="tsd-signature-type tsd-kind-interface">ReadWriteStream</a> <span class="tsd-signature-symbol">|</span> (<span class="tsd-signature-symbol">(</span><span class="tsd-kind-parameter">err</span><span class="tsd-signature-symbol">:</span> <a href="../interfaces/_internal_.ErrnoException.html" class="tsd-signature-type tsd-kind-interface">ErrnoException</a><span class="tsd-signature-symbol">)</span> <span class="tsd-signature-symbol">=&gt;</span> <span class="tsd-signature-type">void</span>))<span class="tsd-signature-symbol">[]</span></span></li></ul></div><h4 class="tsd-returns-title">Returns <a href="../interfaces/_internal_.WritableStream.html" class="tsd-signature-type tsd-kind-interface">WritableStream</a></h4><div class="tsd-comment tsd-typography"><div class="tsd-tag-since"><h4 class="tsd-anchor-link" id="since-6">Since<a href="#since-6" aria-label="Permalink" class="tsd-anchor-icon"><svg viewBox="0 0 24 24" aria-hidden="true"><use href="../assets/icons.svg#icon-anchor"></use></svg></a></h4><p>v10.0.0</p>
</div></div><aside class="tsd-sources"><ul><li>Defined in node_modules/@types/node/stream.d.ts:1560</li></ul></aside></div></li></ul></section></div><div class="col-sidebar"><div class="page-menu"><div class="tsd-navigation settings"><details class="tsd-accordion"><summary class="tsd-accordion-summary"><svg width="20" height="20" viewBox="0 0 24 24" fill="none" aria-hidden="true"><use href="../assets/icons.svg#icon-chevronDown"></use></svg><h3>Settings</h3></summary><div class="tsd-accordion-details"><div class="tsd-filter-visibility"><span class="settings-label">Member Visibility</span><ul id="tsd-filter-options"><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-protected" name="protected"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Protected</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-inherited" name="inherited" checked/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>Inherited</span></label></li><li class="tsd-filter-item"><label class="tsd-filter-input"><input type="checkbox" id="tsd-filter-external" name="external"/><svg width="32" height="32" viewBox="0 0 32 32" aria-hidden="true"><rect class="tsd-checkbox-background" width="30" height="30" x="1" y="1" rx="6" fill="none"></rect><path class="tsd-checkbox-checkmark" d="M8.35422 16.8214L13.2143 21.75L24.6458 10.25" stroke="none" stroke-width="3.5" stroke-linejoin="round" fill="none"></path></svg><span>External</span></label></li></ul></div><div class="tsd-theme-toggle"><label class="settings-label" for="tsd-theme">Theme</label><select id="tsd-theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></div></div></details></div></div><div class="site-menu"><nav class="tsd-navigation"><a href="../modules.html">ts-lambda-api - v2.5.1</a><ul class="tsd-small-nested-navigation" id="tsd-nav-container"><li>Loading...</li></ul></nav></div></div></div><footer><p class="tsd-generator">Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></footer><div class="overlay"></div></body></html>
