<!DOCTYPE html><html class="default"><head><meta charSet="utf-8"/><meta http-equiv="x-ua-compatible" content="IE=edge"/><title>ts-lambda-api - v2.3.3</title><meta name="description" content="Documentation for ts-lambda-api - v2.3.3"/><meta name="viewport" content="width=device-width, initial-scale=1"/><link rel="stylesheet" href="assets/style.css"/><link rel="stylesheet" href="assets/highlight.css"/><script async src="assets/search.js" id="search-script"></script></head><body><script>document.body.classList.add(localStorage.getItem("tsd-theme") || "os")</script><header><div class="tsd-page-toolbar"><div class="container"><div class="table-wrap"><div class="table-cell" id="tsd-search" data-base="."><div class="field"><label for="tsd-search-field" class="tsd-widget search no-caption">Search</label><input type="text" id="tsd-search-field"/></div><ul class="results"><li class="state loading">Preparing search index...</li><li class="state failure">The search index is not available</li></ul><a href="index.html" class="title">ts-lambda-api - v2.3.3</a></div><div class="table-cell" id="tsd-widgets"><div id="tsd-filter"><a href="#" class="tsd-widget options no-caption" data-toggle="options">Options</a><div class="tsd-filter-group"><div class="tsd-select" id="tsd-filter-visibility"><span class="tsd-select-label">All</span><ul class="tsd-select-list"><li data-value="public">Public</li><li data-value="protected">Public/Protected</li><li data-value="private" class="selected">All</li></ul></div> <input type="checkbox" id="tsd-filter-inherited" checked/><label class="tsd-widget" for="tsd-filter-inherited">Inherited</label><input type="checkbox" id="tsd-filter-externals" checked/><label class="tsd-widget" for="tsd-filter-externals">Externals</label></div></div><a href="#" class="tsd-widget menu no-caption" data-toggle="menu">Menu</a></div></div></div></div><div class="tsd-page-title"><div class="container"><h1>ts-lambda-api - v2.3.3 </h1></div></div></header><div class="container container-main"><div class="row"><div class="col-8 col-content"><div class="tsd-panel tsd-typography"><p><a href="https://www.npmjs.com/package/ts-lambda-api"><img src="https://img.shields.io/npm/v/ts-lambda-api.svg?style=flat-square" alt="npm"></a> <a href="https://travis-ci.com/djfdyuruiry/ts-lambda-api"><img src="https://img.shields.io/npm/dw/ts-lambda-api.svg?style=flat-square" alt="downloads"></a></p>
<p><a href="https://travis-ci.com/djfdyuruiry/ts-lambda-api"><img src="https://img.shields.io/travis/com/djfdyuruiry/ts-lambda-api.svg?style=flat-square" alt="build"></a> <a href="https://github.com/djfdyuruiry/ts-lambda-api/network/dependencies"><img src="https://img.shields.io/david/djfdyuruiry/ts-lambda-api.svg?style=flat-square" alt="dependencies"></a></p>

<a href="#ts-lambda-api" id="ts-lambda-api" style="color: inherit; text-decoration: none;">
  <h1>ts-lambda-api</h1>
</a>
<p>Build REST API&#39;s using Typescript &amp; AWS Lambda.</p>
<p><a href="https://github.com/djfdyuruiry/ts-lambda-api/">GitHub Repo</a></p>
<p><a href="https://nodei.co/npm/ts-lambda-api/"><img src="https://nodei.co/npm/ts-lambda-api.png" alt="NPM"></a></p>
<p>Read the full <code>typedoc</code> documentation: <a href="https://djfdyuruiry.github.io/ts-lambda-api/">https://djfdyuruiry.github.io/ts-lambda-api/</a></p>
<p>Framework Features:</p>
<ul>
<li>Decorator based routing for API controllers and endpoint methods</li>
<li>Decorator based parameter binding for endpoint methods (from body, path &amp; query parameters and headers)</li>
<li>API controller dependency injection using <a href="https://github.com/inversify/InversifyJS">InversifyJS</a></li>
<li>Supports invoking your API from both <code>Amazon API Gateway</code> and <code>Amazon Load Balancer</code></li>
<li>Out of the box OpenAPI spec (v3) generation support</li>
<li>Built in support for applying JSON patch operations</li>
</ul>
<p>This project is built on top of the wonderful <a href="https://github.com/jeremydaly/lambda-api">lambda-api</a> framework.</p>
<hr>
<p><strong>Quickstart</strong></p>
<ul>
<li><a href="#create-api">Creating a new API</a></li>
<li><a href="#aws-deploy">Deploy to AWS Lambda</a><ul>
<li><a href="#invoke-lambda">Invoke AWS Lambda</a></li>
</ul>
</li>
</ul>
<p><strong>Docs</strong></p>
<ul>
<li><p><a href="#routing">Routing</a></p>
<ul>
<li><a href="#controller-routes">Controller Routes</a></li>
<li><a href="#endpoint-routes">Endpoint Routes</a></li>
<li><a href="#path-params">Path Parameters</a></li>
<li><a href="#loading-controllers">Manually Loading Controllers</a></li>
</ul>
</li>
<li><p><a href="#request-binding">Request Parameter Binding</a></p>
</li>
<li><p><a href="#responses">Responses</a></p>
</li>
<li><p><a href="#auth-authorization">Authentication &amp; Authorization</a></p>
<ul>
<li><a href="#auth-princ">Authentication and Principals</a></li>
<li><a href="#basic-auth">Basic Authentication</a></li>
<li><a href="#endpoint-princip">Access Principal Context</a></li>
<li><a href="#no-auth-endpoints">Unauthenticated Endpoints</a></li>
<li><a href="#custom-auth">Custom Authentication</a></li>
<li><a href="#authorization">Authorization</a></li>
</ul>
</li>
<li><p><a href="#errors">Error Handling</a></p>
<ul>
<li><a href="#error-interceptors">Error Interceptors</a></li>
<li><a href="#manual-error-interceptors">Manual Error Interceptors</a></li>
<li><a href="#catching-errors">Catching Errors</a></li>
<li><a href="#framework-errors">Framework Error Handling</a></li>
</ul>
</li>
<li><p><a href="#json-patch">JSON Patch Requests</a></p>
</li>
<li><p><a href="#req-res-context">Request / Response Context</a></p>
<ul>
<li><a href="#extend-controller">Extending Controller Class</a></li>
<li><a href="#use-decorators">Using Decorators</a></li>
<li><a href="#send-files">Returning Files in a Response</a></li>
</ul>
</li>
<li><p><a href="#di">Dependency Injection</a></p>
</li>
<li><p><a href="#config">Configuration</a></p>
<ul>
<li><a href="#lambda-api-config">lambda-api</a></li>
<li><a href="#config-reference">Reference</a></li>
</ul>
</li>
<li><p><a href="#logging">Logging</a></p>
<ul>
<li><a href="#logging-writing">Writing Logs</a></li>
<li><a href="#logging-api">API</a></li>
<li><a href="#lambda-api-logging">lambda-api</a></li>
</ul>
</li>
<li><p><a href="#open-api">OpenAPI (Swagger)</a></p>
<ul>
<li><a href="#open-api-decorators">Decorators</a></li>
<li><a href="#open-api-yaml">YAML Support</a></li>
<li><a href="#open-api-auth">Authentication</a></li>
</ul>
</li>
<li><p><a href="#testing">Testing</a></p>
</li>
<li><p><a href="#useful-links">Useful Links</a></p>
</li>
</ul>
<hr>

<a href="#creating-a-new-api" id="creating-a-new-api" style="color: inherit; text-decoration: none;">
  <h2><a id="create-api"></a>Creating a new API</h2>
</a>
<hr>
<p>This is a short guide to creating your first API using <code>ts-lambda-api</code>. It is somewhat opinionated about project structure, but most of this can be easily customised.</p>
<p><strong>Note: Node.js v16.x &amp; Typescript v4.x are recommended. Other versions may work perfectly fine, but have not been tested.</strong></p>
<ul>
<li><p>Create a directory for your project and run <code>npm init</code> to create your <code>package.json</code></p>
</li>
<li><p>Install required packages:</p>
</li>
</ul>
<pre><code class="language-shell"><span class="hl-0">npm install ts-lambda-api</span><br/><span class="hl-0">npm install -D typescript @types/node aws-sdk</span>
</code></pre>
<ul>
<li>Open <code>package.json</code> and add a script to enable access to the Typescript compiler:</li>
</ul>
<pre><code class="language-json"><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;scripts&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;tsc&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;tsc&quot;</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<ul>
<li>Create a new file named <code>tsconfig.json</code>, add the following:</li>
</ul>
<pre><code class="language-json"><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;compilerOptions&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;module&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;commonjs&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;moduleResolution&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;node&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;emitDecoratorMetadata&quot;</span><span class="hl-0">: </span><span class="hl-3">true</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;experimentalDecorators&quot;</span><span class="hl-0">: </span><span class="hl-3">true</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;strict&quot;</span><span class="hl-0">: </span><span class="hl-3">false</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;baseUrl&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;.&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;outDir&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;dist&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;paths&quot;</span><span class="hl-0">: {</span><br/><span class="hl-0">            </span><span class="hl-1">&quot;*&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">                </span><span class="hl-2">&quot;node_modules/*&quot;</span><br/><span class="hl-0">            ]</span><br/><span class="hl-0">        },</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;target&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;es2017&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">        </span><span class="hl-1">&quot;lib&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">            </span><span class="hl-2">&quot;es2017&quot;</span><br/><span class="hl-0">        ]</span><br/><span class="hl-0">    },</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;include&quot;</span><span class="hl-0">: [</span><br/><span class="hl-0">        </span><span class="hl-2">&quot;src/**/*&quot;</span><br/><span class="hl-0">    ]</span><br/><span class="hl-0">}</span>
</code></pre>
<p><strong>Note: <code>emitDecoratorMetadata</code>, <code>experimentalDecorators</code> and <code>strict</code> flags are required to be set as shown above to compile your app</strong></p>
<ul>
<li><p>Create a new directory named <code>src</code></p>
</li>
<li><p>Create a new file named <code>src/api.ts</code>, add the following:</p>
</li>
</ul>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> </span><span class="hl-3">*</span><span class="hl-0"> </span><span class="hl-4">as</span><span class="hl-0"> </span><span class="hl-5">path</span><span class="hl-0"> </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;path&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">AppConfig</span><span class="hl-0">, </span><span class="hl-5">ApiLambdaApp</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">appConfig</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">AppConfig</span><span class="hl-0">()</span><br/><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">base</span><span class="hl-0"> = </span><span class="hl-2">&quot;/api/v1&quot;</span><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">version</span><span class="hl-0"> = </span><span class="hl-2">&quot;v1&quot;</span><br/><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">controllersPath</span><span class="hl-0"> = [</span><span class="hl-5">path</span><span class="hl-0">.</span><span class="hl-7">join</span><span class="hl-0">(</span><span class="hl-5">__dirname</span><span class="hl-0">, </span><span class="hl-2">&quot;controllers&quot;</span><span class="hl-0">)]</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-5">controllersPath</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">async</span><span class="hl-0"> </span><span class="hl-3">function</span><span class="hl-0"> </span><span class="hl-7">handler</span><span class="hl-0">(</span><span class="hl-5">event</span><span class="hl-0">, </span><span class="hl-5">context</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-4">await</span><span class="hl-0"> </span><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-7">run</span><span class="hl-0">(</span><span class="hl-5">event</span><span class="hl-0">, </span><span class="hl-5">context</span><span class="hl-0">)</span><br/><span class="hl-0">}</span>
</code></pre>
<ul>
<li><p>Add a <code>src/controllers</code> directory</p>
</li>
<li><p>Create a new file in <code>controllers</code> named <code>HelloWorldController.ts</code>, add the following:</p>
</li>
</ul>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">Controller</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/hello-world&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">() </span><span class="hl-8">// all controller classes must be decorated with injectable</span><br/><span class="hl-8">// extending Controller is optional, it provides convience methods</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">HelloWorldController</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">Controller</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// GET, POST, PUT, PATCH and DELETE are supported</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-2">&quot;hello&quot;</span><span class="hl-5">:</span><span class="hl-0"> </span><span class="hl-2">&quot;world&quot;</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// sub routes can be specifed in method decorators</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/sub-resource&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getSubResource</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-2">&quot;hello&quot;</span><span class="hl-5">:</span><span class="hl-0"> </span><span class="hl-2">&quot;world&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-2">&quot;sub&quot;</span><span class="hl-5">:</span><span class="hl-0"> </span><span class="hl-2">&quot;resource&quot;</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<ul>
<li>Compile the application by running:</li>
</ul>
<pre><code><span class="hl-5">npm</span><span class="hl-0"> </span><span class="hl-5">run</span><span class="hl-0"> </span><span class="hl-5">tsc</span>
</code></pre>
<hr>

<a href="#deploy-to-aws-lambda" id="deploy-to-aws-lambda" style="color: inherit; text-decoration: none;">
  <h2><a id="aws-deploy"></a>Deploy to AWS Lambda</h2>
</a>
<hr>
<p><em><strong>Note</strong>: AWS supplies the <code>aws-sdk</code> package at runtime when running your Lambda applications, so there is no need to include this in your deployment package.</em></p>
<ul>
<li><p>Build your application</p>
</li>
<li><p>Remove dev dependencies from your <code>node_modules</code> directory:</p>
</li>
</ul>
<pre><code><span class="hl-5">rm</span><span class="hl-0"> -</span><span class="hl-5">rf</span><span class="hl-0"> </span><span class="hl-5">node_modules</span><br/><span class="hl-5">npm</span><span class="hl-0"> </span><span class="hl-5">install</span><span class="hl-0"> --</span><span class="hl-5">only</span><span class="hl-0">=</span><span class="hl-5">prod</span>
</code></pre>
<p><em>This will <strong>massively</strong> reduce the size of your deployment package</em></p>
<ul>
<li>Run the following commands to package your app:</li>
</ul>
<pre><code class="language-shell"><span class="hl-0">zip -r dist/lambda.zip node_modules</span><br/><span class="hl-7">cd</span><span class="hl-0"> dist</span><br/><span class="hl-0">zip -r lambda.zip ./</span>
</code></pre>
<ul>
<li>Upload your lambda using the <code>dist/lambda.zip</code> file. Specify <code>app.handler</code> as the function handler. See: <a href="https://docs.aws.amazon.com/lambda/latest/dg/nodejs-create-deployment-pkg.html">https://docs.aws.amazon.com/lambda/latest/dg/nodejs-create-deployment-pkg.html</a></li>
</ul>
<hr>

<a href="#invoke-lambda" id="invoke-lambda" style="color: inherit; text-decoration: none;">
  <h3><a id="invoke-lambda"></a>Invoke Lambda</h3>
</a>
<hr>
<ul>
<li><p>Create an AWS Load Balancer and point it to your new API Lambda. See: <a href="https://docs.aws.amazon.com/elasticloadbalancing/latest/application/lambda-functions.html">https://docs.aws.amazon.com/elasticloadbalancing/latest/application/lambda-functions.html</a></p>
</li>
<li><p>You can now call your new ALB to see your API in action:</p>
</li>
</ul>
<pre><code class="language-shell"><span class="hl-0">wget -qO - https://some.alb.dns.address/api/v1/hello-world/</span>
</code></pre>
<ul>
<li>You should see:</li>
</ul>
<pre><code class="language-json"><span class="hl-0">{</span><span class="hl-1">&quot;hello&quot;</span><span class="hl-0">:</span><span class="hl-2">&quot;world&quot;</span><span class="hl-0">}</span>
</code></pre>
<hr>

<a href="#routing" id="routing" style="color: inherit; text-decoration: none;">
  <h2><a id="routing"></a>Routing</h2>
</a>
<hr>
<p>Routing is configured using decorators on both controller classes and endpoint methods. You can also define a global base path (e.x. <code>/api/v1</code>) for your API by configuring the <code>base</code> property when passing your app configuration to the <code>ApiLambdaApp</code> class. (See the <code>Creating a new API</code> section)</p>

<a href="#controller-routes" id="controller-routes" style="color: inherit; text-decoration: none;">
  <h3><a id="controller-routes"></a>Controller Routes</h3>
</a>
<p>You can declare a root path for all methods in a controller using the <code>apiController</code> decorator.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0">, </span><span class="hl-5">POST</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/hello-world&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">HelloWorldController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-8">// handle get /hello-world requests</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    @</span><span class="hl-7">POST</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">post</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-8">// handle post /hello-world requests</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#endpoint-routes" id="endpoint-routes" style="color: inherit; text-decoration: none;">
  <h3><a id="endpoint-routes"></a>Endpoint Routes</h3>
</a>
<p>You can declare a path for any given method in a controller when using the endpoint decorators. The <code>apiController</code> decorator is not required on the class to use this form of routing.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/items&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getItems</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-8">// handle get /store/items requests</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<hr>

<a href="#path-parameters" id="path-parameters" style="color: inherit; text-decoration: none;">
  <h3><a id="path-params"></a>Path Parameters</h3>
</a>
<p>You can include parameters as part of your routes, when you need to capture parts of the URL.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">pathParam</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/item/:id&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getItems</span><span class="hl-0">(@</span><span class="hl-7">pathParam</span><span class="hl-0">(</span><span class="hl-2">&quot;id&quot;</span><span class="hl-0">) </span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// do something with id</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<hr>
<p>You can also combine controller and endpoint path parameters.</p>
<hr>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">pathParam</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store/:storeId&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/item/:id&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getItem</span><span class="hl-0">(@</span><span class="hl-7">pathParam</span><span class="hl-0">(</span><span class="hl-2">&quot;storeId&quot;</span><span class="hl-0">) </span><span class="hl-5">storeId</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">, @</span><span class="hl-7">pathParam</span><span class="hl-0">(</span><span class="hl-2">&quot;id&quot;</span><span class="hl-0">) </span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// do something with storeId and id</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p><strong>Note all path parameters are passed in as strings, you will need to cast these if required</strong></p>
<hr>

<a href="#manually-loading-controllers" id="manually-loading-controllers" style="color: inherit; text-decoration: none;">
  <h3><a id="loading-controllers"></a>Manually Loading Controllers</h3>
</a>
<hr>
<p>The default IOC app <code>Container</code> enables the <code>autoBindInjectable</code> option. Controllers decorated with
<code>@injectable</code> are dynamicallly loaded from the required <code>controllersPath</code> directory during 
initialisation. However, controllers can be explicity specified instead of relying on the <code>@injectable</code> 
decoration to dynamically load the controllers from a directory.</p>
<p>Create an IOC <code>Container</code> with the <code>autoBindInjectable</code> option disabled. Bind the desired controller 
classes to the container and pass the instance into the <code>ApiLambdaApp</code> constructor. The <code>controllersPath</code>
parameter is ignored when the custom container&#39;s <code>autoBindInjectable</code> option disabled.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">Container</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&#39;inversify&#39;</span><span class="hl-0">;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">ApiLambdaApp</span><span class="hl-0">, </span><span class="hl-5">ApiRequest</span><span class="hl-0">, </span><span class="hl-5">AppConfig</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&#39;ts-lambda-api&#39;</span><span class="hl-0">;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">AppController</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&#39;./controllers/AppController&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">appConfig</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">AppConfig</span><span class="hl-0">();</span><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">base</span><span class="hl-0"> = </span><span class="hl-2">&#39;/api/v1&#39;</span><span class="hl-0">;</span><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">version</span><span class="hl-0"> = </span><span class="hl-2">&#39;v1&#39;</span><span class="hl-0">;</span><br/><br/><span class="hl-8">// Bind the controllers to a container instance with @injectable disabled</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">appContainer</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">Container</span><span class="hl-0">({ </span><span class="hl-5">autoBindInjectable:</span><span class="hl-0"> </span><span class="hl-3">false</span><span class="hl-0"> });</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">appController</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">AppController</span><span class="hl-0">();</span><br/><span class="hl-5">appContainer</span><span class="hl-0">.</span><span class="hl-7">bind</span><span class="hl-0">(</span><span class="hl-5">AppController</span><span class="hl-0">).</span><span class="hl-7">toConstantValue</span><span class="hl-0">(</span><span class="hl-5">appController</span><span class="hl-0">);</span><br/><br/><span class="hl-8">// Pass the customer container into the app - controllersPath is ignored</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-3">undefined</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">, </span><span class="hl-5">appContainer</span><span class="hl-0">);</span><br/><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-7">lambdaHandler</span><span class="hl-0"> = </span><span class="hl-3">async</span><span class="hl-0"> (</span><span class="hl-5">event</span><span class="hl-0">: </span><span class="hl-9">ApiRequest</span><span class="hl-0">, </span><span class="hl-5">context</span><span class="hl-0">: </span><span class="hl-9">any</span><span class="hl-0">) </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-4">await</span><span class="hl-0"> </span><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-7">run</span><span class="hl-0">(</span><span class="hl-5">event</span><span class="hl-0">, </span><span class="hl-5">context</span><span class="hl-0">);</span><br/><span class="hl-0">};</span>
</code></pre>
<p><strong>Note you do not need to decorate controller classes with @injectable when autoBindInjectable is disabled</strong></p>
<hr>

<a href="#request-parameter-binding" id="request-parameter-binding" style="color: inherit; text-decoration: none;">
  <h2><a id="request-binding"></a>Request Parameter Binding</h2>
</a>
<hr>
<p>Different parts of the HTTP request can be bound to endpoint method parameters using decorators.</p>
<ul>
<li><code>queryParam</code> - Query string parameter</li>
<li><code>header</code> - HTTP header value</li>
<li><code>body</code> - Entity from request body, this will be an object if the request contains JSON, otherwise it will simply be a string</li>
<li><code>rawBody</code> - Entity from request body as a Buffer, containing a string or binary data</li>
</ul>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">body</span><span class="hl-0">, </span><span class="hl-5">header</span><span class="hl-0">, </span><span class="hl-5">queryParam</span><span class="hl-0">, </span><span class="hl-5">rawBody</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0">, </span><span class="hl-5">POST</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">Thing</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./Thing&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/hello-world&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">HelloWorldController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getThingById</span><span class="hl-0">(@</span><span class="hl-7">queryParam</span><span class="hl-0">(</span><span class="hl-2">&quot;id&quot;</span><span class="hl-0">) </span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// do something with id</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/some/other/route&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getContentType</span><span class="hl-0">(@</span><span class="hl-7">header</span><span class="hl-0">(</span><span class="hl-2">&quot;content-type&quot;</span><span class="hl-0">) </span><span class="hl-5">contentType</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// do something with contentType</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    @</span><span class="hl-7">POST</span><span class="hl-0">(</span><span class="hl-2">&quot;/thing&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">addThing</span><span class="hl-0">(@</span><span class="hl-5">body</span><span class="hl-0"> </span><span class="hl-5">thing</span><span class="hl-0">: </span><span class="hl-9">Thing</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// do something with thing</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    @</span><span class="hl-7">POST</span><span class="hl-0">(</span><span class="hl-2">&quot;/upload-file&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">addThing</span><span class="hl-0">(@</span><span class="hl-5">rawBody</span><span class="hl-0"> </span><span class="hl-5">file</span><span class="hl-0">: </span><span class="hl-9">Buffer</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// do something with file</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<hr>

<a href="#responses" id="responses" style="color: inherit; text-decoration: none;">
  <h2><a id="responses"></a>Responses</h2>
</a>
<hr>
<p>There are two ways to respond to requests:</p>
<ul>
<li>Return a value from your endpoint method</li>
<li>Use the response context to send a response (see <code>Request / Response Context</code> section below - the context has convience methods for html, json, files etc.)</li>
</ul>
<p>By default all return values are serialised to JSON in the response body and the <code>content-type</code> response header is set to <code>application/json</code>. To change this you can use the <code>produces</code> and <code>controllerProduces</code> decorators.</p>
<p>Only JSON content types are serialised automatically, all other types simply convert the return value to a string.</p>
<p>To set the response content type for all methods, use <code>controllerProduces</code> on a class.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">controllerProduces</span><span class="hl-0">, </span><span class="hl-5">pathParam</span><span class="hl-0">, </span><span class="hl-5">produces</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">Item</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./Item&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store/:storeId&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">controllerProduces</span><span class="hl-0">(</span><span class="hl-2">&quot;application/xml&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/item/:id&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getItem</span><span class="hl-0">(@</span><span class="hl-7">pathParam</span><span class="hl-0">(</span><span class="hl-2">&quot;storeId&quot;</span><span class="hl-0">) </span><span class="hl-5">storeId</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">, @</span><span class="hl-7">pathParam</span><span class="hl-0">(</span><span class="hl-2">&quot;id&quot;</span><span class="hl-0">) </span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">item</span><span class="hl-0"> = </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">lookupItem</span><span class="hl-0">(</span><span class="hl-5">storeId</span><span class="hl-0">, </span><span class="hl-5">id</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">serialiseToXml</span><span class="hl-0">(</span><span class="hl-5">item</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">lookupItem</span><span class="hl-0">(</span><span class="hl-5">storeId</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">, </span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// go get the item from somewhere, db for example</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">serialiseToXml</span><span class="hl-0">(</span><span class="hl-5">item</span><span class="hl-0">: </span><span class="hl-9">Item</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// use 3rd party library to serialise item</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>For an individual method, use <code>produces</code>. This will override <code>controllerProduces</code> for that method, if present on the controller class.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">produces</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/motd&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">MessageOfTheDayController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    @</span><span class="hl-7">produces</span><span class="hl-0">(</span><span class="hl-2">&quot;text/plain&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">(){</span><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-2">&quot;Message of the Day!&quot;</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<hr>

<a href="#authentication-amp-authorization" id="authentication-amp-authorization" style="color: inherit; text-decoration: none;">
  <h2><a id="auth-authorization"></a>Authentication &amp; Authorization</h2>
</a>
<hr>
<p>This framework supports authenticating requests and authorization for controllers and endpoints. It can be used to configure HTTP authentication, token based auth and role based access control (ACLs).</p>
<p>Implementation is heavily inspired by the Dropwizard framework for Java.</p>

<a href="#authentication-and-principals" id="authentication-and-principals" style="color: inherit; text-decoration: none;">
  <h3><a id="auth-princ"></a>Authentication and Principals</h3>
</a>
<p>Authentication is preformed by filter classes that are executed before invoking an endpoint; all filter classes implement the <code>IAuthFilter</code> interface.</p>
<p>Filters use information from the HTTP request to authenticate the request. If authentication is successful, a filter will return a principal. A principal is a simple class that contains information about the current user/entity that has been granted access to the endpoint.</p>
<p>To use authentication you must implement your own principal by extending the <code>Principal</code> class:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">Principal</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreUser</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">Principal</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// we will use this later, see the Authorization section</span><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-5">roles</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">[] = []</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// you can define your user model properties in this class</span><br/><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">constructor</span><span class="hl-0">(</span><span class="hl-5">name</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-3">super</span><span class="hl-0">(</span><span class="hl-5">name</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#basic-authentication" id="basic-authentication" style="color: inherit; text-decoration: none;">
  <h3><a id="basic-auth"></a>Basic Authentication</h3>
</a>
<p>HTTP Basic authentication is supported out of the box by the <code>BasicAuthFilter</code> filter abstract class. You extend this class to implement your authentication logic:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">BasicAuthFilter</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StoreUser</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./StoreUser&quot;</span><br/><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreAuthFilter</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">BasicAuthFilter</span><span class="hl-0">&lt;</span><span class="hl-9">StoreUser</span><span class="hl-0">&gt; {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">readonly</span><span class="hl-0"> </span><span class="hl-5">name</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0"> = </span><span class="hl-5">StoreAuthFilter</span><span class="hl-0">.</span><span class="hl-5">name</span><br/><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">async</span><span class="hl-0"> </span><span class="hl-7">authenticate</span><span class="hl-0">(</span><span class="hl-5">basicAuth</span><span class="hl-0">: </span><span class="hl-9">BasicAuth</span><span class="hl-0">): </span><span class="hl-9">Promise</span><span class="hl-0">&lt;</span><span class="hl-9">StoreUser</span><span class="hl-0"> | </span><span class="hl-9">undefined</span><span class="hl-0">&gt; {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> = </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">getUserFromDb</span><span class="hl-0">(</span><span class="hl-5">basicAuth</span><span class="hl-0">.</span><span class="hl-5">username</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">user</span><span class="hl-0"> &amp;&amp; </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">checkUserPasswordHash</span><span class="hl-0">(</span><span class="hl-5">user</span><span class="hl-0">, </span><span class="hl-5">basicAuth</span><span class="hl-0">.</span><span class="hl-5">password</span><span class="hl-0">)) {</span><br/><span class="hl-0">            </span><span class="hl-8">// returning a principal signals that the request has been authorized</span><br/><span class="hl-0">            </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">user</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">getUserFromDb</span><span class="hl-0">(</span><span class="hl-5">username</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">): </span><span class="hl-9">StoreUser</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-8">// get the user details from a database, if it exists, otherwise we return null/undefined</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">checkUserPasswordHash</span><span class="hl-0">(</span><span class="hl-5">user</span><span class="hl-0">: </span><span class="hl-9">StoreUser</span><span class="hl-0">, </span><span class="hl-5">password</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">): </span><span class="hl-9">boolean</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-8">// get the user password hash from a database</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>You register your authentication filter when setting up your application instance:</p>
<pre><code class="language-typescript"><span class="hl-8">// build config and controllers path...</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-5">controllersPath</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">authFilter</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">StoreAuthFilter</span><span class="hl-0">()</span><br/><br/><span class="hl-8">// this will protect your endpoints using the auth filter to authenticate requests</span><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-5">middlewareRegistry</span><span class="hl-0">.</span><span class="hl-7">addAuthFilter</span><span class="hl-0">(</span><span class="hl-5">authFilter</span><span class="hl-0">)</span><br/><span class="hl-8">// export handler</span>
</code></pre>

<a href="#access-principal-context" id="access-principal-context" style="color: inherit; text-decoration: none;">
  <h3><a id="endpoint-princip"></a>Access Principal Context</h3>
</a>
<p>Once a user has been authenticated you can pass the principal instance into the target endpoint. You can do this by adding a <code>principal</code> parameter decorator to your endpoint method.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">pathParam</span><span class="hl-0">, </span><span class="hl-5">principal</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/item/:id&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getItem</span><span class="hl-0">(@</span><span class="hl-5">principal</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0">: </span><span class="hl-9">StoreUser</span><span class="hl-0">, @</span><span class="hl-7">pathParam</span><span class="hl-0">(</span><span class="hl-2">&quot;id&quot;</span><span class="hl-0">) </span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// do something with the user context</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#unauthenticated-endpoints" id="unauthenticated-endpoints" style="color: inherit; text-decoration: none;">
  <h3><a id="no-auth-endpoints"></a>Unauthenticated Endpoints</h3>
</a>
<p>There are several situations where you might want to disable authentication for a specific endpoint:</p>
<ul>
<li>Healthcheck / Status endpoint</li>
<li>Login Endpoint</li>
<li>Public API endpoints for unauthenticated users (browsing products without logging in)</li>
</ul>
<p>To do this you need to use the <code>noAuth</code> and <code>controllerNoAuth</code> decorators.</p>
<p>For an endpoint:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">body</span><span class="hl-0">, </span><span class="hl-5">noAuth</span><span class="hl-0">, </span><span class="hl-5">principal</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0">, </span><span class="hl-5">POST</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">LoginRequest</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./LoginRequest&quot;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StoreUser</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./StoreUser&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/user&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">UserController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">POST</span><span class="hl-0">(</span><span class="hl-2">&quot;/login&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    @</span><span class="hl-5">noAuth</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">login</span><span class="hl-0">(@</span><span class="hl-5">body</span><span class="hl-0"> </span><span class="hl-5">loginRequest</span><span class="hl-0">: </span><span class="hl-9">LoginRequest</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// attempt to log in...</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/profile&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">login</span><span class="hl-0">(@</span><span class="hl-5">principal</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0">: </span><span class="hl-9">StoreUser</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// only authorised users can call this endpoint...</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>For all endpoints in a controller:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">controllerNoAuth</span><span class="hl-0">, </span><span class="hl-5">body</span><span class="hl-0">, </span><span class="hl-5">POST</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">SearchRequest</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./SearchRequest&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/public&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-5">controllerNoAuth</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">PublicController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">POST</span><span class="hl-0">(</span><span class="hl-2">&quot;/search/products&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">searchProducts</span><span class="hl-0">(@</span><span class="hl-5">body</span><span class="hl-0"> </span><span class="hl-5">searchRequest</span><span class="hl-0">: </span><span class="hl-9">SearchRequest</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// I can be called without authentication</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-8">// ...other declared endpoints are also be called without authentication...</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#custom-authentication" id="custom-authentication" style="color: inherit; text-decoration: none;">
  <h3><a id="custom-auth"></a>Custom Authentication</h3>
</a>
<p>If you wish to implement popular authentication mechanisms or make your own, you need to implement the <code>IAuthFilter</code> interface. It accepts two type parameters:</p>
<ul>
<li><code>T</code> - The model class for your authentication data</li>
<li><code>U</code> - A principal class</li>
</ul>
<p>Authentication data classes are free form, for example:</p>
<pre><code class="language-typescript"><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">TokenAuth</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-5">token</span><span class="hl-0">: </span><span class="hl-9">string</span><br/><span class="hl-0">}</span>
</code></pre>
<p>Your auth filter implementation must provide a method for extracting your authentication data, and a method that uses that data to authenticate the current request.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">Request</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">IAuthFilter</span><span class="hl-0">, </span><span class="hl-5">Principal</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StoreUser</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./StoreUser&quot;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">TokenAuth</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./TokenAuth&quot;</span><br/><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">TokenAuthFilter</span><span class="hl-0">&lt;</span><span class="hl-9">T</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">Principal</span><span class="hl-0">&gt; </span><span class="hl-3">implements</span><span class="hl-0"> </span><span class="hl-9">IAuthFilter</span><span class="hl-0">&lt;</span><span class="hl-9">TokenAuth</span><span class="hl-0">, </span><span class="hl-9">StoreUser</span><span class="hl-0">&gt; {</span><br/><span class="hl-0">    </span><span class="hl-8">// required to be defined for implementations, see:</span><br/><span class="hl-0">    </span><span class="hl-8">//   https://www.iana.org/assignments/http-authschemes/http-authschemes.xhtml</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">readonly</span><span class="hl-0"> </span><span class="hl-5">authenticationSchemeName</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0"> = </span><span class="hl-2">&quot;Bearer&quot;</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">readonly</span><span class="hl-0"> </span><span class="hl-5">name</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0"> = </span><span class="hl-5">TokenAuthFilter</span><span class="hl-0">.</span><span class="hl-5">name</span><br/><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">async</span><span class="hl-0"> </span><span class="hl-7">extractAuthData</span><span class="hl-0">(</span><span class="hl-5">request</span><span class="hl-0">: </span><span class="hl-9">Request</span><span class="hl-0">): </span><span class="hl-9">Promise</span><span class="hl-0">&lt;</span><span class="hl-9">TokenAuth</span><span class="hl-0"> | </span><span class="hl-9">undefined</span><span class="hl-0">&gt; {</span><br/><span class="hl-0">        </span><span class="hl-8">// extract the data if the auth header is present</span><br/><span class="hl-0">        </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">request</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0">[</span><span class="hl-2">&quot;Authorization&quot;</span><span class="hl-0">]) {</span><br/><span class="hl-0">            </span><span class="hl-4">return</span><span class="hl-0"> {</span><br/><span class="hl-0">                </span><span class="hl-5">token:</span><span class="hl-0"> </span><span class="hl-5">request</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0">[</span><span class="hl-2">&quot;Authorization&quot;</span><span class="hl-0">]</span><br/><span class="hl-0">            }</span><br/><span class="hl-0">        }</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// if you don&#39;t return any auth data, the request will be marked as unauthorized</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">async</span><span class="hl-0"> </span><span class="hl-7">authenticate</span><span class="hl-0">(</span><span class="hl-5">tokenAuth</span><span class="hl-0">: </span><span class="hl-9">TokenAuth</span><span class="hl-0">): </span><span class="hl-9">Promise</span><span class="hl-0">&lt;</span><span class="hl-9">StoreUser</span><span class="hl-0"> | </span><span class="hl-9">undefined</span><span class="hl-0">&gt; {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0"> = </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">getUserByTokenFromDb</span><span class="hl-0">(</span><span class="hl-5">tokenAuth</span><span class="hl-0">.</span><span class="hl-5">token</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">user</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">user</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">getUserByTokenFromDb</span><span class="hl-0">(</span><span class="hl-5">token</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// get the user for the token and return the user&#39;s details</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>Tip: You can make your class abstract and then make the <code>authenticate</code> method abstract to enable your custom auth filter to be re-usable. This way, you simply extend your custom fiter and implement the authentication logic for your application.</p>

<a href="#authorization" id="authorization" style="color: inherit; text-decoration: none;">
  <h3><a id="authorization"></a>Authorization</h3>
</a>
<p>To implement role based authorization you implement the <code>IAuthorizer</code> interface.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">IAuthorizer</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StoreUser</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./StoreUser&quot;</span><br/><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreAuthorizer</span><span class="hl-0"> </span><span class="hl-3">implements</span><span class="hl-0"> </span><span class="hl-9">IAuthorizer</span><span class="hl-0">&lt;</span><span class="hl-9">StoreUser</span><span class="hl-0">&gt; {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">readonly</span><span class="hl-0"> </span><span class="hl-5">name</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0"> = </span><span class="hl-5">StoreAuthorizer</span><span class="hl-0">.</span><span class="hl-5">name</span><br/><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">async</span><span class="hl-0"> </span><span class="hl-7">authorize</span><span class="hl-0">(</span><span class="hl-5">user</span><span class="hl-0">: </span><span class="hl-9">StoreUser</span><span class="hl-0">, </span><span class="hl-5">role</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">): </span><span class="hl-9">Promise</span><span class="hl-0">&lt;</span><span class="hl-9">boolean</span><span class="hl-0">&gt; {</span><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">user</span><span class="hl-0">.</span><span class="hl-5">roles</span><span class="hl-0">.</span><span class="hl-7">includes</span><span class="hl-0">(</span><span class="hl-5">role</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>When a user is successfully authenticated by an auth filter, this returns a principal which is passed to the configured authorizer if a resource is marked as restricted. To restrict all endpoints in a controller, use the <code>controllerRolesAllowed</code> decorator:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">controllerRolesAllowed</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">controllerRolesAllowed</span><span class="hl-0">(</span><span class="hl-2">&quot;STORE_GUEST&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;STORE_MANAGER&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/item/:id&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getItem</span><span class="hl-0">(@</span><span class="hl-7">pathParam</span><span class="hl-0">(</span><span class="hl-2">&quot;id&quot;</span><span class="hl-0">) </span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// this endpoint can only be accessed with principles that are authorized with the STORE_MANAGER role</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>You can restrict a single enpoint using the <code>rolesAllowed</code> decorator:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">rolesAllowed</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/item/:id&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    @</span><span class="hl-7">rolesAllowed</span><span class="hl-0">(</span><span class="hl-2">&quot;STORE_MANAGER&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getItem</span><span class="hl-0">(@</span><span class="hl-7">pathParam</span><span class="hl-0">(</span><span class="hl-2">&quot;id&quot;</span><span class="hl-0">) </span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// this endpoint can only be accessed with principles that are authorized with the STORE_MANAGER role</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>You can combine both the controller and endpoint decorators for roles. In this case, if endpoint roles are present, they override the controller role set.</p>
<p>You register your authentication filter when setting up your application instance:</p>
<pre><code class="language-typescript"><span class="hl-8">// build config and controllers path...</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-5">controllersPath</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">authorizer</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">StoreAuthorizer</span><span class="hl-0">()</span><br/><br/><span class="hl-8">// this will protect your endpoints using the authorizer to check access roles</span><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-5">middlewareRegistry</span><span class="hl-0">.</span><span class="hl-7">addAuthorizer</span><span class="hl-0">(</span><span class="hl-5">authorizer</span><span class="hl-0">)</span><br/><span class="hl-8">// export handler</span>
</code></pre>
<hr>

<a href="#error-handling" id="error-handling" style="color: inherit; text-decoration: none;">
  <h2><a id="errors"></a>Error Handling</h2>
</a>
<hr>
<p>When an unexpected error is thrown in one of your endpoints, you can choose how to handle this. There are three general techniques:</p>
<ol>
<li>Use an error interceptor</li>
<li>Catch the error in your endpoint logic</li>
<li>Let the framework handle the error</li>
</ol>

<a href="#error-interceptors" id="error-interceptors" style="color: inherit; text-decoration: none;">
  <h3><a id="error-interceptors"></a>Error Interceptors</h3>
</a>
<p>Error interceptors are classes that can be configured to be invoked when an error occurs when calling a given controller or endpoint. Interceptors extend the <code>ErrorInterceptor</code> class and provide an implementation for an <code>intercept</code> method.</p>
<p>Interceptor instances are built using the InversifyJS app container, so you can add any dependencies as constructor parameters if you configure the container correctly.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><span class="hl-0">;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">ApiError</span><span class="hl-0">, </span><span class="hl-5">ErrorInterceptor</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreErrorInterceptor</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">ErrorInterceptor</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">async</span><span class="hl-0"> </span><span class="hl-7">intercept</span><span class="hl-0">(</span><span class="hl-5">apiError</span><span class="hl-0">: </span><span class="hl-9">ApiError</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// endpointTarget and controllerTarget will set before this is called</span><br/><span class="hl-0">        </span><span class="hl-8">// (they are set to the controller and endpoint that threw the error)</span><br/><span class="hl-0">        </span><span class="hl-5">apiError</span><span class="hl-0">.</span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-7">status</span><span class="hl-0">(</span><span class="hl-10">500</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-5">statusCode:</span><span class="hl-0"> </span><span class="hl-10">500</span><span class="hl-0">,</span><br/><span class="hl-0">            </span><span class="hl-5">errorMessage:</span><span class="hl-0"> </span><span class="hl-2">&quot;Error getting items for store&quot;</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>In your controller you can then use the <code>controllerErrorInterceptor</code> decorator to specify the error interceptor to use:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">controllerErrorInterceptor</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">StoreErrorInterceptor</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./StoreErrorInterceptor&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">controllerErrorInterceptor</span><span class="hl-0">(</span><span class="hl-5">StoreErrorInterceptor</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/items&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getItems</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">getItemsFromDb</span><span class="hl-0">()</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">getItemsFromDb</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-8">// get all the items from the DB, may error</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>You can also use the <code>errorInterceptor</code> decorator on individual endpoints for more fine grained error control. Endpoint interceptors will override controller interceptors.</p>

<a href="#manual-error-interceptors" id="manual-error-interceptors" style="color: inherit; text-decoration: none;">
  <h3><a id="manual-error-interceptors"></a>Manual Error Interceptors</h3>
</a>
<p>You can manually register interceptors when setting up your application instance:</p>
<pre><code class="language-typescript"><span class="hl-8">// build config and controllers path...</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-5">controllersPath</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">errorInterceptor</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">StoreErrorInterceptor</span><span class="hl-0">()</span><br/><br/><span class="hl-8">// this will intercept errors thrown by any endpoint</span><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-5">middlewareRegistry</span><span class="hl-0">.</span><span class="hl-7">addErrorInterceptor</span><span class="hl-0">(</span><span class="hl-5">errorInterceptor</span><span class="hl-0">)</span><br/><span class="hl-8">// export handler</span>
</code></pre>
<p>You can intercept only the errors thrown by an endpoint by setting <code>endpointTarget</code>:</p>
<pre><code class="language-typescript"><span class="hl-8">// pattern for endpoints is {controller class name}::{endpoint method name}</span><br/><span class="hl-5">errorInterceptor</span><span class="hl-0">.</span><span class="hl-5">endpointTarget</span><span class="hl-0"> = </span><span class="hl-2">&quot;StoreController::getItems&quot;</span>
</code></pre>
<p>You can intercept only the errors thrown by a controller by setting <code>controllerTarget</code>:</p>
<pre><code class="language-typescript"><span class="hl-8">// controllers are identified by class name</span><br/><span class="hl-5">errorInterceptor</span><span class="hl-0">.</span><span class="hl-5">controllerTarget</span><span class="hl-0"> = </span><span class="hl-2">&quot;StoreController&quot;</span>
</code></pre>
<p><strong>Note: using this type of interceptor is overridden if the target controller or endpoint has an interceptor configured</strong></p>

<a href="#catching-errors" id="catching-errors" style="color: inherit; text-decoration: none;">
  <h3><a id="catching-errors"></a>Catching Errors</h3>
</a>
<p>You can use a try/catch block and the <code>Response</code> class to handle errors:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">Controller</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">Controller</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">(</span><span class="hl-2">&quot;/items&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">getItems</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-4">try</span><span class="hl-0"> {</span><br/><span class="hl-0">            </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">getItemsFromDb</span><span class="hl-0">()</span><br/><span class="hl-0">        } </span><span class="hl-4">catch</span><span class="hl-0"> (</span><span class="hl-5">ex</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-8">// log ex...maybe?</span><br/><br/><span class="hl-0">            </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-7">status</span><span class="hl-0">(</span><span class="hl-10">500</span><span class="hl-0">).</span><span class="hl-7">send</span><span class="hl-0">({</span><br/><span class="hl-0">                </span><span class="hl-5">statusCode:</span><span class="hl-0"> </span><span class="hl-10">500</span><span class="hl-0">,</span><br/><span class="hl-0">                </span><span class="hl-5">errorMessage:</span><span class="hl-0"> </span><span class="hl-2">&quot;Error occurred getting items from backend&quot;</span><br/><span class="hl-0">            })</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">getItemsFromDb</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-8">// get all the items from the DB</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p><em>Note: this can also be done by injecting the <code>Response</code> class instance using the <code>response</code> parameter decorator, instead of extending <code>Controller</code>.</em></p>

<a href="#framework-error-handling" id="framework-error-handling" style="color: inherit; text-decoration: none;">
  <h3><a id="framework-errors"></a>Framework Error Handling</h3>
</a>
<p>If you simply preform your logic in your endpoint method without catching any errors yourself, the framework will catch the error and return a HTTP 500 response with error details. Below is a JSON snippet showing an example.</p>
<pre><code class="language-json"><span class="hl-0">{</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;error&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;...some error that the framework caught when calling an endpoint....&quot;</span><br/><span class="hl-0">}</span>
</code></pre>
<hr>

<a href="#json-patch-requests" id="json-patch-requests" style="color: inherit; text-decoration: none;">
  <h2><a id="json-patch"></a>JSON Patch Requests</h2>
</a>
<hr>
<p>This library supports <a href="http://jsonpatch.com/">JSON Patch</a> format for updating entities without having to upload the entire entity. To use it in your endpoints, ensure your controller extends the <code>Controller</code> class, an example is below:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">pathParam</span><span class="hl-0">, </span><span class="hl-5">produces</span><span class="hl-0">, </span><span class="hl-5">JsonPatch</span><span class="hl-0">, </span><span class="hl-5">PATCH</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">Item</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./Item&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/store&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">StoreController</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">Controller</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">PATCH</span><span class="hl-0">(</span><span class="hl-2">&quot;/item/:id&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">modifyItem</span><span class="hl-0">(@</span><span class="hl-7">pathParam</span><span class="hl-0">(</span><span class="hl-2">&quot;id&quot;</span><span class="hl-0">) </span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">, @</span><span class="hl-5">body</span><span class="hl-0"> </span><span class="hl-5">jsonPatch</span><span class="hl-0">: </span><span class="hl-9">JsonPatch</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">item</span><span class="hl-0"> = </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">lookupItem</span><span class="hl-0">(</span><span class="hl-5">id</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// apply the patch operation</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">modifiedItem</span><span class="hl-0"> = </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">applyJsonPatch</span><span class="hl-0">&lt;</span><span class="hl-9">Item</span><span class="hl-0">&gt;(</span><span class="hl-5">jsonPatch</span><span class="hl-0">, </span><span class="hl-5">item</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// do something with modifiedItem</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">lookupItem</span><span class="hl-0">(</span><span class="hl-5">id</span><span class="hl-0">: </span><span class="hl-9">string</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-8">// go get the item from somewhere, db for example</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p><strong>Under the hood, the API uses the <a href="https://www.npmjs.com/package/fast-json-patch">fast-json-patch</a> package</strong></p>
<hr>

<a href="#request--response-context" id="request--response-context" style="color: inherit; text-decoration: none;">
  <h2><a id="req-res-context"></a>Request / Response Context</h2>
</a>
<hr>
<p>If you want to read request bodies or write to the response, there are several supported approaches.</p>

<a href="#extending-controller-class" id="extending-controller-class" style="color: inherit; text-decoration: none;">
  <h3><a id="extend-controller"></a>Extending Controller Class</h3>
</a>
<p>If you extend the controller class, you get access to the request and response context.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">Controller</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/hello-world&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">HelloWorldController</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">Controller</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">queryStringParam</span><span class="hl-0"> = </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">request</span><span class="hl-0">.</span><span class="hl-5">query</span><span class="hl-0">[</span><span class="hl-2">&quot;someField&quot;</span><span class="hl-0">]</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// ... do some logic ...</span><br/><br/><span class="hl-0">        </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-7">html</span><span class="hl-0">(</span><span class="hl-2">&quot;&lt;h1&gt;Hello World&lt;/h1&gt;&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#using-decorators" id="using-decorators" style="color: inherit; text-decoration: none;">
  <h3><a id="use-decorators"></a>Using Decorators</h3>
</a>
<p>You can use parameter decorators to inject the request and response context.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">Request</span><span class="hl-0">, </span><span class="hl-5">Response</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">request</span><span class="hl-0">, </span><span class="hl-5">response</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/hello-world&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">HelloWorldController</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">(@</span><span class="hl-5">request</span><span class="hl-0"> </span><span class="hl-5">request</span><span class="hl-0">: </span><span class="hl-9">Request</span><span class="hl-0">, @</span><span class="hl-5">response</span><span class="hl-0"> </span><span class="hl-5">response</span><span class="hl-0">: </span><span class="hl-9">Response</span><span class="hl-0">) {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">queryStringParam</span><span class="hl-0"> = </span><span class="hl-5">request</span><span class="hl-0">.</span><span class="hl-5">query</span><span class="hl-0">[</span><span class="hl-2">&quot;someField&quot;</span><span class="hl-0">]</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// ... do some logic ...</span><br/><br/><span class="hl-0">        </span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-7">html</span><span class="hl-0">(</span><span class="hl-2">&quot;&lt;h1&gt;Hello World&lt;/h1&gt;&quot;</span><span class="hl-0">);</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#returning-files-in-a-response" id="returning-files-in-a-response" style="color: inherit; text-decoration: none;">
  <h3><a id="send-files"></a>Returning Files in a Response</h3>
</a>
<p>You can return files by using the <code>sendFile</code> method in the response context.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">Controller</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/files&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">FilesController</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">Controller</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">file</span><span class="hl-0">: </span><span class="hl-9">Buffer</span><span class="hl-0"> = </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">getFile</span><span class="hl-0">()</span><br/><br/><span class="hl-0">        </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-7">sendFile</span><span class="hl-0">(</span><span class="hl-5">file</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">getFile</span><span class="hl-0">(): </span><span class="hl-9">Buffer</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-8">// ... do some logic to get a file Buffer ...</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p><strong>The <code>Request</code> and <code>Response</code> classes are documented in the <a href="https://github.com/jeremydaly/lambda-api">lambda-api</a> package.</strong></p>
<hr>

<a href="#-dependency-injection" id="-dependency-injection" style="color: inherit; text-decoration: none;">
  <h2><a id="di"></a> Dependency Injection</h2>
</a>
<hr>
<p>Configuring the IOC container to enable dependency injection for your controllers is easy. Once you build an <code>ApiLambdaApp</code> instance you can call the <code>configureApp</code> method like below:</p>
<pre><code class="language-typescript"><span class="hl-8">// build config and controllers path...</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-5">controllersPath</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-7">configureApp</span><span class="hl-0">(</span><span class="hl-5">container</span><span class="hl-0"> </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// bind interface to implementation class, for example</span><br/><span class="hl-0">    </span><span class="hl-5">container</span><span class="hl-0">.</span><span class="hl-7">bind</span><span class="hl-0">(</span><span class="hl-5">IMyService</span><span class="hl-0">)</span><br/><span class="hl-0">        .</span><span class="hl-7">to</span><span class="hl-0">(</span><span class="hl-5">MyServiceImplementation</span><span class="hl-0">)</span><br/><span class="hl-0">})</span><br/><br/><span class="hl-8">// export handler</span>
</code></pre>
<p><strong>Note: Any classes that you are going to inject need to be decorated with <code>injectable</code>, any subclasses are also required to be decorated</strong></p>
<p>In your controllers you can then use the registered types as constructor parameters:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">inject</span><span class="hl-0">, </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">IMyService</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./IMyService&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/hello-world&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">MyController</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">constructor</span><span class="hl-0">(@</span><span class="hl-7">inject</span><span class="hl-0">(</span><span class="hl-5">IMyService</span><span class="hl-0">) </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-3">readonly</span><span class="hl-0"> </span><span class="hl-5">service</span><span class="hl-0">: </span><span class="hl-9">IMyService</span><span class="hl-0">) {</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-8">// use injected service to do cool stuff</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>See the <a href="https://github.com/inversify/InversifyJS">InversifyJS</a> package documentation for full guidance how to use the <code>Container</code> class to manage dependencies.</p>
<hr>

<a href="#configuration" id="configuration" style="color: inherit; text-decoration: none;">
  <h2><a id="config"></a>Configuration</h2>
</a>
<hr>
<p>When building an application instance you pass an <code>AppConfig</code> instance to the constructor. If you want to provide your own application config it is recommended to extend this class .</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">AppConfig</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">DatabaseConfig</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./DatabaseConfig&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">MyCustomConfig</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">AppConfig</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-5">databaseConfig</span><span class="hl-0">: </span><span class="hl-9">DatabaseConfig</span><br/><span class="hl-0">}</span>
</code></pre>
<p>You can then configure the IOC container to bind to your configuration instance.</p>
<pre><code class="language-typescript"><span class="hl-8">// build controllers path...</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">appConfig</span><span class="hl-0">: </span><span class="hl-9">MyCustomConfig</span><span class="hl-0"> = </span><span class="hl-7">buildConfig</span><span class="hl-0">()</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-5">controllersPath</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-7">configureApp</span><span class="hl-0">(</span><span class="hl-5">container</span><span class="hl-0"> </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-5">container</span><span class="hl-0">.</span><span class="hl-7">bind</span><span class="hl-0">(</span><span class="hl-5">MyCustomConfig</span><span class="hl-0">)</span><br/><span class="hl-0">        .</span><span class="hl-7">toConstantValue</span><span class="hl-0">(</span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-8">// export handler</span>
</code></pre>
<p>After which, you can inject your config into your controllers or services.</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">inject</span><span class="hl-0">, </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">MyCustomConfig</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./MyCustomConfig&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/hello-world&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">MyController</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">constructor</span><span class="hl-0">(@</span><span class="hl-7">inject</span><span class="hl-0">(</span><span class="hl-5">MyCustomConfig</span><span class="hl-0">) </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-3">readonly</span><span class="hl-0"> </span><span class="hl-5">config</span><span class="hl-0">: </span><span class="hl-9">MyCustomConfig</span><span class="hl-0">) {</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-7">getStuffFromDb</span><span class="hl-0">()</span><br/><span class="hl-0">    }</span><br/><br/><span class="hl-0">    </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-7">getStuffFromDb</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-8">// use this.config to configure a database connection</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p><strong>Note: The <code>AppConfig</code> class supports all the configuration fields documented in the <a href="https://github.com/jeremydaly/lambda-api">lambda-api</a> package.</strong></p>

<a href="#reference" id="reference" style="color: inherit; text-decoration: none;">
  <h3><a id="config-reference"></a>Reference</h3>
</a>
<p>For a complete reference see the <a href="https://djfdyuruiry.github.io/ts-lambda-api/classes/appconfig.html">AppConfig</a> docs.</p>

<a href="#lambda-api" id="lambda-api" style="color: inherit; text-decoration: none;">
  <h3><a id="lambda-api-config"></a>lambda-api</h3>
</a>
<p>Configuring <code>lambda-api</code> directly can be done by calling the <code>configureApi</code> method like below:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">API</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;lambda-api&quot;</span><br/><span class="hl-4">import</span><span class="hl-0"> </span><span class="hl-3">*</span><span class="hl-0"> </span><span class="hl-4">as</span><span class="hl-0"> </span><span class="hl-5">xmljs</span><span class="hl-0"> </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;xml-js&quot;</span><br/><br/><span class="hl-8">// build config and controllers path...</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-5">controllersPath</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><br/><span class="hl-5">app</span><span class="hl-0">.</span><span class="hl-7">configureApi</span><span class="hl-0">(</span><span class="hl-5">api</span><span class="hl-0">: </span><span class="hl-5">API</span><span class="hl-0"> </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// add middleware handler, for example</span><br/><span class="hl-0">    </span><span class="hl-5">api</span><span class="hl-0">.</span><span class="hl-7">use</span><span class="hl-0">((</span><span class="hl-5">req</span><span class="hl-0">,</span><span class="hl-5">res</span><span class="hl-0">,</span><span class="hl-5">next</span><span class="hl-0">) </span><span class="hl-3">=&gt;</span><span class="hl-0"> {</span><br/><span class="hl-0">        </span><span class="hl-8">// parses any incoming XML data into an object</span><br/><span class="hl-0">        </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-5">headers</span><span class="hl-0">[</span><span class="hl-2">&quot;content-type&quot;</span><span class="hl-0">] === </span><span class="hl-2">&quot;application/xml&quot;</span><span class="hl-0">) {</span><br/><span class="hl-0">            </span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-5">body</span><span class="hl-0"> = </span><span class="hl-5">xmljs</span><span class="hl-0">.</span><span class="hl-7">xml2json</span><span class="hl-0">(</span><span class="hl-5">req</span><span class="hl-0">.</span><span class="hl-5">body</span><span class="hl-0">, {</span><span class="hl-5">compact:</span><span class="hl-0"> </span><span class="hl-3">true</span><span class="hl-0">})</span><br/><span class="hl-0">        }</span><br/><br/><span class="hl-0">        </span><span class="hl-7">next</span><span class="hl-0">()</span><br/><span class="hl-0">    })</span><br/><span class="hl-0">})</span><br/><span class="hl-8">// export handler</span>
</code></pre>
<p><strong>Note: any middleware handlers and manual routes will not apply auth filters, authorizers or error interceptors</strong></p>
<p>See the <a href="https://github.com/jeremydaly/lambda-api">lambda-api</a> package documentation for guidance how to use the <code>API</code> class.</p>

<a href="#logging" id="logging" style="color: inherit; text-decoration: none;">
  <h2><a id="logging"></a>Logging</h2>
</a>
<p>A logger interface is provided that can write messages to standard out. You can configure this logger using the <code>serverLogging</code> key in the <code>AppConfig</code> class. See the <a href="#config-reference">Config Reference</a> for details on options available. This complements the existing logging provided by <code>lambda-api</code>, which can be configured using the <code>logger</code> key.</p>
<p>By default, the logger is set to <code>info</code> and outputs messages as simple strings.</p>
<p>The format of the messages written out is:</p>
<pre><code><span class="hl-5">level</span><span class="hl-0">  </span><span class="hl-3">class</span><span class="hl-0">                   </span><span class="hl-9">message</span><br/><span class="hl-9">vvvvv</span><span class="hl-0"> </span><span class="hl-9">vvvvvvvv</span><span class="hl-0">   </span><span class="hl-9">vvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvvv</span><br/><span class="hl-9">INFO</span><span class="hl-0">  </span><span class="hl-9">Endpoint</span><span class="hl-0"> - </span><span class="hl-9">Invoking</span><span class="hl-0"> </span><span class="hl-9">endpoint</span><span class="hl-0">: [</span><span class="hl-9">GET</span><span class="hl-0">] /</span><span class="hl-9">open</span><span class="hl-0">-</span><span class="hl-9">api</span><span class="hl-0">.</span><span class="hl-9">yml</span>
</code></pre>
<p>Below is some example output, include a stack trace from an <code>Error</code> instance:</p>
<pre><code><span class="hl-6">INFO</span><span class="hl-0"> </span><span class="hl-5">ApiLambdaApp</span><span class="hl-0"> - </span><span class="hl-5">Received</span><span class="hl-0"> </span><span class="hl-5">event</span><span class="hl-0">, </span><span class="hl-5">initialising</span><span class="hl-0"> </span><span class="hl-5">controllers</span><span class="hl-0"> </span><span class="hl-5">and</span><span class="hl-0"> </span><span class="hl-5">processing</span><span class="hl-0"> </span><span class="hl-5">event</span><br/><span class="hl-6">INFO</span><span class="hl-0"> </span><span class="hl-5">Server</span><span class="hl-0"> - </span><span class="hl-5">Processing</span><span class="hl-0"> </span><span class="hl-6">API</span><span class="hl-0"> </span><span class="hl-5">request</span><span class="hl-0"> </span><span class="hl-5">event</span><span class="hl-0"> </span><span class="hl-5">for</span><span class="hl-0"> </span><span class="hl-11">path</span><span class="hl-0">:</span><span class="hl-12"> /test/</span><br/><span class="hl-6">INFO</span><span class="hl-0"> </span><span class="hl-5">Endpoint</span><span class="hl-0"> - [</span><span class="hl-6">GET</span><span class="hl-0">] /</span><span class="hl-5">test</span><span class="hl-0"> - </span><span class="hl-5">Authenticating</span><span class="hl-0"> </span><span class="hl-5">request</span><br/><span class="hl-6">ERROR</span><span class="hl-0"> </span><span class="hl-5">Endpoint</span><span class="hl-0"> - [</span><span class="hl-6">GET</span><span class="hl-0">] /</span><span class="hl-5">test</span><span class="hl-0"> - </span><span class="hl-9">Error</span><span class="hl-0"> </span><span class="hl-5">processing</span><span class="hl-0"> </span><span class="hl-5">endpoint</span><span class="hl-0"> </span><span class="hl-5">request</span><br/><span class="hl-11">Error</span><span class="hl-0">: </span><span class="hl-5">authenticate</span><span class="hl-0"> </span><span class="hl-5">failed</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-5">TestAuthFilter</span><span class="hl-0">.</span><span class="hl-7">authenticate</span><span class="hl-0"> (/</span><span class="hl-5">home</span><span class="hl-0">/</span><span class="hl-5">matthew</span><span class="hl-0">/</span><span class="hl-5">src</span><span class="hl-0">/</span><span class="hl-5">ts</span><span class="hl-0">/</span><span class="hl-5">ts</span><span class="hl-0">-</span><span class="hl-5">lambda</span><span class="hl-0">-</span><span class="hl-5">api</span><span class="hl-0">/</span><span class="hl-5">tests</span><span class="hl-0">/</span><span class="hl-5">src</span><span class="hl-0">/</span><span class="hl-5">test</span><span class="hl-0">-</span><span class="hl-5">components</span><span class="hl-0">/</span><span class="hl-5">TestAuthFilter</span><span class="hl-0">.</span><span class="hl-5">ts</span><span class="hl-0">:</span><span class="hl-10">25</span><span class="hl-0">:</span><span class="hl-10">19</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-5">Endpoint</span><span class="hl-0">.</span><span class="hl-7">authenticateRequest</span><span class="hl-0"> (/</span><span class="hl-5">home</span><span class="hl-0">/</span><span class="hl-5">matthew</span><span class="hl-0">/</span><span class="hl-5">src</span><span class="hl-0">/</span><span class="hl-5">ts</span><span class="hl-0">/</span><span class="hl-5">ts</span><span class="hl-0">-</span><span class="hl-5">lambda</span><span class="hl-0">-</span><span class="hl-5">api</span><span class="hl-0">/</span><span class="hl-5">dist</span><span class="hl-0">/</span><span class="hl-5">api</span><span class="hl-0">/</span><span class="hl-5">Endpoint</span><span class="hl-0">.</span><span class="hl-5">js</span><span class="hl-0">:</span><span class="hl-10">15</span><span class="hl-0">:</span><span class="hl-10">2640</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-7">processTicksAndRejections</span><span class="hl-0"> (</span><span class="hl-5">internal</span><span class="hl-0">/</span><span class="hl-5">process</span><span class="hl-0">/</span><span class="hl-5">task_queues</span><span class="hl-0">.</span><span class="hl-5">js</span><span class="hl-0">:</span><span class="hl-10">86</span><span class="hl-0">:</span><span class="hl-10">5</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-5">process</span><span class="hl-0">.</span><span class="hl-5">runNextTicks</span><span class="hl-0"> [</span><span class="hl-4">as</span><span class="hl-0"> </span><span class="hl-9">_tickCallback</span><span class="hl-0">] (</span><span class="hl-5">internal</span><span class="hl-0">/</span><span class="hl-5">process</span><span class="hl-0">/</span><span class="hl-5">task_queues</span><span class="hl-0">.</span><span class="hl-5">js</span><span class="hl-0">:</span><span class="hl-10">56</span><span class="hl-0">:</span><span class="hl-10">3</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-9">Function</span><span class="hl-0">.</span><span class="hl-5">Module</span><span class="hl-0">.</span><span class="hl-7">runMain</span><span class="hl-0"> (</span><span class="hl-5">internal</span><span class="hl-0">/</span><span class="hl-5">modules</span><span class="hl-0">/</span><span class="hl-5">cjs</span><span class="hl-0">/</span><span class="hl-5">loader</span><span class="hl-0">.</span><span class="hl-5">js</span><span class="hl-0">:</span><span class="hl-10">880</span><span class="hl-0">:</span><span class="hl-10">11</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-7">runMain</span><span class="hl-0"> (/</span><span class="hl-5">home</span><span class="hl-0">/</span><span class="hl-5">matthew</span><span class="hl-0">/.</span><span class="hl-5">node</span><span class="hl-0">-</span><span class="hl-5">spawn</span><span class="hl-0">-</span><span class="hl-5">wrap</span><span class="hl-0">-</span><span class="hl-10">13541</span><span class="hl-0">-13</span><span class="hl-5">c0098ec456</span><span class="hl-0">/</span><span class="hl-5">node</span><span class="hl-0">:</span><span class="hl-10">68</span><span class="hl-0">:</span><span class="hl-10">10</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-9">Function</span><span class="hl-0">.&lt;</span><span class="hl-5">anonymous</span><span class="hl-0">&gt; (/</span><span class="hl-5">home</span><span class="hl-0">/</span><span class="hl-5">matthew</span><span class="hl-0">/.</span><span class="hl-5">node</span><span class="hl-0">-</span><span class="hl-5">spawn</span><span class="hl-0">-</span><span class="hl-5">wrap</span><span class="hl-0">-</span><span class="hl-10">13541</span><span class="hl-0">-13</span><span class="hl-5">c0098ec456</span><span class="hl-0">/</span><span class="hl-5">node</span><span class="hl-0">:</span><span class="hl-10">171</span><span class="hl-0">:</span><span class="hl-10">5</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-9">Object</span><span class="hl-0">.&lt;</span><span class="hl-5">anonymous</span><span class="hl-0">&gt; (/</span><span class="hl-5">home</span><span class="hl-0">/</span><span class="hl-5">matthew</span><span class="hl-0">/</span><span class="hl-5">src</span><span class="hl-0">/</span><span class="hl-5">ts</span><span class="hl-0">/</span><span class="hl-5">ts</span><span class="hl-0">-</span><span class="hl-5">lambda</span><span class="hl-0">-</span><span class="hl-5">api</span><span class="hl-0">/</span><span class="hl-5">node_modules</span><span class="hl-0">/</span><span class="hl-5">nyc</span><span class="hl-0">/</span><span class="hl-5">bin</span><span class="hl-0">/</span><span class="hl-5">wrap</span><span class="hl-0">.</span><span class="hl-5">js</span><span class="hl-0">:</span><span class="hl-10">23</span><span class="hl-0">:</span><span class="hl-10">4</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-5">Module</span><span class="hl-0">.</span><span class="hl-7">_compile</span><span class="hl-0"> (</span><span class="hl-5">internal</span><span class="hl-0">/</span><span class="hl-5">modules</span><span class="hl-0">/</span><span class="hl-5">cjs</span><span class="hl-0">/</span><span class="hl-5">loader</span><span class="hl-0">.</span><span class="hl-5">js</span><span class="hl-0">:</span><span class="hl-10">816</span><span class="hl-0">:</span><span class="hl-10">30</span><span class="hl-0">)</span><br/><span class="hl-0">    </span><span class="hl-5">at</span><span class="hl-0"> </span><span class="hl-9">Object</span><span class="hl-0">.</span><span class="hl-5">Module</span><span class="hl-0">.</span><span class="hl-5">_extensions</span><span class="hl-0">..</span><span class="hl-7">js</span><span class="hl-0"> (</span><span class="hl-5">internal</span><span class="hl-0">/</span><span class="hl-5">modules</span><span class="hl-0">/</span><span class="hl-5">cjs</span><span class="hl-0">/</span><span class="hl-5">loader</span><span class="hl-0">.</span><span class="hl-5">js</span><span class="hl-0">:</span><span class="hl-10">827</span><span class="hl-0">:</span><span class="hl-10">10</span><span class="hl-0">)</span>
</code></pre>
<p>If you set the <code>format</code> to <code>json</code> the log messages will look like this:</p>
<pre><code class="language-json"><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;level&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;INFO&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;msg&quot;</span><span class="hl-0">: </span><span class="hl-2">&quot;Endpoint - Invoking endpoint: [GET] /open-api.yml&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-1">&quot;time&quot;</span><span class="hl-0">: </span><span class="hl-10">1555865906882</span><span class="hl-0"> </span><span class="hl-8">// milliseconds since epoch</span><br/><span class="hl-0">}</span>
</code></pre>
<p>This format matches the keys used by the <code>lambda-api</code> framework in it&#39;s output.</p>

<a href="#writing-logs" id="writing-logs" style="color: inherit; text-decoration: none;">
  <h3><a id="logging-writing"></a>Writing Logs</h3>
</a>
<p>To write logs you will ned a logger instance. There are three ways to get one:</p>
<ul>
<li>Extend the <code>Controller</code> class in your controller:</li>
</ul>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiController</span><span class="hl-0">, </span><span class="hl-5">Controller</span><span class="hl-0">, </span><span class="hl-5">GET</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">TestController</span><span class="hl-0"> </span><span class="hl-3">extends</span><span class="hl-0"> </span><span class="hl-9">Controller</span><span class="hl-0"> {</span><br/><span class="hl-0">    @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">info</span><span class="hl-0">(</span><span class="hl-2">&quot;In GET method!&quot;</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-2">&quot;OK&quot;</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<ul>
<li>Use a <code>LogFactory</code> instance to build it:</li>
</ul>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">inject</span><span class="hl-0">, </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">AppConfig</span><span class="hl-0">, </span><span class="hl-5">LogFactory</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">SomeServiceYouMightMake</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// get your app config using dependency injection</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">constructor</span><span class="hl-0">(@</span><span class="hl-7">inject</span><span class="hl-0">(</span><span class="hl-5">AppConfig</span><span class="hl-0">) </span><span class="hl-3">private</span><span class="hl-0"> </span><span class="hl-3">readonly</span><span class="hl-0"> </span><span class="hl-5">appConfig</span><span class="hl-0">: </span><span class="hl-9">AppConfig</span><span class="hl-0">)</span><br/><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">doStuff</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">factory</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">LogFactory</span><span class="hl-0">(</span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">logger</span><span class="hl-0"> = </span><span class="hl-5">factory</span><span class="hl-0">.</span><span class="hl-7">getLogger</span><span class="hl-0">(</span><span class="hl-5">SomeServiceYouMightMake</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">debug</span><span class="hl-0">(</span><span class="hl-2">&quot;Inside doStuff!&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<ul>
<li>Use the <code>LogFactory</code> static methods to build it:</li>
</ul>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">LogFactory</span><span class="hl-0">, </span><span class="hl-5">LogLevel</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">SomeServiceYouMightMake</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">doStuff</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-8">// you can specify the level and format of the log</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">logger</span><span class="hl-0"> = </span><span class="hl-5">LogFactory</span><span class="hl-0">.</span><span class="hl-7">getCustomLogger</span><span class="hl-0">(</span><span class="hl-5">SomeServiceYouMightMake</span><span class="hl-0">, </span><span class="hl-5">LogLevel</span><span class="hl-0">.</span><span class="hl-5">debug</span><span class="hl-0">, </span><span class="hl-2">&quot;json&quot;</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">debug</span><span class="hl-0">(</span><span class="hl-2">&quot;Inside doStuff!&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#-server-logger-api" id="-server-logger-api" style="color: inherit; text-decoration: none;">
  <h3><a id="logging-api"></a> Server Logger API</h3>
</a>
<p>The logging API supports formatting of messages using the <a href="https://www.npmjs.com/package/sprintf-js"><code>sprintf-js</code></a> npm module, simply pass in your arguments and put placeholders in your message string:</p>
<pre><code class="language-typescript"><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">warn</span><span class="hl-0">(</span><span class="hl-2">&quot;Hello there %s, how are you?&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;Roy&quot;</span><span class="hl-0">)</span><br/><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">debug</span><span class="hl-0">(</span><span class="hl-2">&quot;Task status: %s. Task data: %j&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;success&quot;</span><span class="hl-0">, {</span><span class="hl-5">event:</span><span class="hl-0"> </span><span class="hl-2">&quot;run batch&quot;</span><span class="hl-0">})</span>
</code></pre>
<p>Using this will help to speed up your app if you do a lot of logging, because uneccessary work to convert values to strings and the JSON serialization of debug messages will not take place if a higher error level is set.</p>
<hr>
<p>Below is an example of the methods available on logger instances:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">LogFactory</span><span class="hl-0">, </span><span class="hl-5">LogLevel</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">SomeServiceYouMightMake</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">doStuff</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">logger</span><span class="hl-0"> = </span><span class="hl-5">LogFactory</span><span class="hl-0">.</span><span class="hl-7">getCustomLogger</span><span class="hl-0">(</span><span class="hl-5">SomeServiceYouMightMake</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// different levels</span><br/><span class="hl-0">        </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">trace</span><span class="hl-0">(</span><span class="hl-2">&quot;trace&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">        </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">fatal</span><span class="hl-0">(</span><span class="hl-2">&quot;fatal&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">        </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">error</span><span class="hl-0">(</span><span class="hl-2">&quot;error&quot;</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// log exceptions with stack traces, also supports formatting of message</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">exception</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-9">Error</span><span class="hl-0">(</span><span class="hl-2">&quot;Bad stuff happened&quot;</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">errorWithStack</span><span class="hl-0">(</span><span class="hl-2">&quot;An error occurred somewhere, error code: %d&quot;</span><span class="hl-0">, </span><span class="hl-5">exception</span><span class="hl-0">, </span><span class="hl-10">20000</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// check if a level is enabled</span><br/><span class="hl-0">        </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">debugEnabled</span><span class="hl-0">()) {</span><br/><span class="hl-0">            </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">debug</span><span class="hl-0">(</span><span class="hl-2">&quot;Mode #%d&quot;</span><span class="hl-0">, </span><span class="hl-10">355</span><span class="hl-0">)</span><br/><span class="hl-0">        }</span><br/><br/><span class="hl-0">        </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">traceEnabled</span><span class="hl-0">()) {</span><br/><span class="hl-0">            </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">trace</span><span class="hl-0">(</span><span class="hl-2">&quot;Sending data: %j&quot;</span><span class="hl-0">, {</span><span class="hl-5">some:</span><span class="hl-0"> {</span><span class="hl-5">payload:</span><span class="hl-0"> </span><span class="hl-10">2345</span><span class="hl-0">}})</span><br/><span class="hl-0">        }</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// check if the logging is currenly off (i.e. level is set to `off`)</span><br/><span class="hl-0">        </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">isOff</span><span class="hl-0">()) {</span><br/><span class="hl-0">            </span><span class="hl-8">// react to the cruel reality....</span><br/><span class="hl-0">        }</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// pass level in as parameter</span><br/><span class="hl-0">        </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">log</span><span class="hl-0">(</span><span class="hl-5">LogLevel</span><span class="hl-0">.</span><span class="hl-5">info</span><span class="hl-0">, </span><span class="hl-2">&quot;Manual call to the %s method&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;log&quot;</span><span class="hl-0">)</span><br/><br/><span class="hl-0">        </span><span class="hl-8">// check level is enabled using aparameter</span><br/><span class="hl-0">        </span><span class="hl-4">if</span><span class="hl-0"> (</span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">levelEnabled</span><span class="hl-0">(</span><span class="hl-5">LogLevel</span><span class="hl-0">.</span><span class="hl-5">info</span><span class="hl-0">)) {</span><br/><span class="hl-0">            </span><span class="hl-5">logger</span><span class="hl-0">.</span><span class="hl-7">info</span><span class="hl-0">(</span><span class="hl-2">&quot;I am enabled!&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">        }</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>

<a href="#lambda-api-1" id="lambda-api-1" style="color: inherit; text-decoration: none;">
  <h3><a id="lambda-api-logging"></a>lambda-api</h3>
</a>
<p>Logging is also provided by the <a href="https://github.com/jeremydaly/lambda-api">lambda-api</a> package, use the <code>AppConfig</code> instance passed to <code>ApiLambdaApp</code> to configure logging using the <code>logger</code> key. See the <a href="#config-reference">Config Reference</a> for details on options available.</p>
<hr>

<a href="#openapi-swagger" id="openapi-swagger" style="color: inherit; text-decoration: none;">
  <h2><a id="open-api"></a>OpenAPI (Swagger)</h2>
</a>
<hr>
<p>The OpenAPI Specification (FKA Swagger) is supported out of the box. If you are not familar with it, check out <a href="https://github.com/OAI/OpenAPI-Specification">https://github.com/OAI/OpenAPI-Specification</a></p>
<p><strong>This framework supports only OpenAPI v3</strong></p>
<p>The following features are supported:</p>
<ul>
<li>Generating of an OpenAPI Specification, which includes:<ul>
<li>All endpoints with full path and HTTP method</li>
<li>Custom names and descriptions for endpoints</li>
<li>Grouping of endpoints together by API</li>
<li>Endpoint query, path and header parameters (set by parameter decorators)</li>
<li>Response content type headers (set by <code>produces</code> or <code>controllerProduces</code> decorators)</li>
<li>Request and Response bodies: class types, primitive values and files</li>
<li>Response HTTP status codes</li>
<li>HTTP Basic security scheme (when a basic auth filter is configured)</li>
<li>Custom auth filter security schemes</li>
</ul>
</li>
<li>Specification files can be generated in <code>JSON</code> or <code>YAML</code> format (see <a href="#open-api-yaml">YAML Support</a>)</li>
</ul>
<p>To enable it, use the <code>openApi</code> property in the <code>AppConfig</code> class when building your app:</p>
<pre><code class="language-typescript"><span class="hl-8">// build controllers path...</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">appConfig</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">AppConfig</span><span class="hl-0">()</span><br/><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">base</span><span class="hl-0"> = </span><span class="hl-2">&quot;/api/v1&quot;</span><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">version</span><span class="hl-0"> = </span><span class="hl-2">&quot;v1&quot;</span><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">openApi</span><span class="hl-0">.</span><span class="hl-5">enabled</span><span class="hl-0"> = </span><span class="hl-3">true</span><br/><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-5">controllersPath</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><span class="hl-8">// export handler</span>
</code></pre>
<p>You can then request your specification using the paths:</p>
<ul>
<li><code>/api/v1/open-api.json</code> - JSON format</li>
<li><code>/api/v1/open-api.yml</code> - YAML format</li>
</ul>

<a href="#decorators" id="decorators" style="color: inherit; text-decoration: none;">
  <h3><a id="open-api-decorators"></a>Decorators</h3>
</a>
<p>To further document your API endpoints you can use OpenAPI decorators.</p>
<ul>
<li><p>Customize the names of APIs and endpoints using <code>api</code>:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">api</span><span class="hl-0">, </span><span class="hl-5">apiController</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/some&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">api</span><span class="hl-0">(</span><span class="hl-2">&quot;Awesome API&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;descripton of API for doing amazing things&quot;</span><span class="hl-0">) </span><span class="hl-8">// the second parameter is optional</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">SomeController</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-8">// ... endpoints ...</span><br/><span class="hl-0">}</span>
</code></pre>
</li>
</ul>
<p><em>The same <code>@api</code> name can be used on multiple controllers, meaning you can group by API area rather than controller</em></p>
<ul>
<li><p>Add descriptions to APIs and endpoints using <code>apiOperation</code>:</p>
<pre><code class="language-typescript"><span class="hl-0">@</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">@</span><span class="hl-7">apiOperation</span><span class="hl-0">({ </span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-2">&quot;get stuff&quot;</span><span class="hl-0">, </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;go get some stuff&quot;</span><span class="hl-0">}) </span><span class="hl-8">// description is optional</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">() {</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-2">&quot;OK&quot;</span><br/><span class="hl-0">}</span>
</code></pre>
</li>
<li><p>Describe endpoint request and response content using <code>apiRequest</code> and <code>apiResponse</code>:</p>
<pre><code class="language-typescript"><span class="hl-8">// using model classes</span><br/><span class="hl-0">@</span><span class="hl-7">POST</span><span class="hl-0">()</span><br/><span class="hl-0">@</span><span class="hl-7">apiOperation</span><span class="hl-0">({</span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-2">&quot;add stuff&quot;</span><span class="hl-0">, </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;go add some stuff&quot;</span><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiRequest</span><span class="hl-0">({</span><span class="hl-5">class:</span><span class="hl-0"> </span><span class="hl-5">Person</span><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiResponse</span><span class="hl-0">(</span><span class="hl-10">201</span><span class="hl-0">, {</span><span class="hl-5">class:</span><span class="hl-0"> </span><span class="hl-5">Person</span><span class="hl-0">}) </span><span class="hl-8">// each response is associated with a HTTP status code</span><br/><span class="hl-0">@</span><span class="hl-7">apiResponse</span><span class="hl-0">(</span><span class="hl-10">400</span><span class="hl-0">, {</span><span class="hl-5">class:</span><span class="hl-0"> </span><span class="hl-5">ApiError</span><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiResponse</span><span class="hl-0">(</span><span class="hl-10">500</span><span class="hl-0">, {</span><span class="hl-5">class:</span><span class="hl-0"> </span><span class="hl-5">ApiError</span><span class="hl-0">})</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">post</span><span class="hl-0">(@</span><span class="hl-5">body</span><span class="hl-0"> </span><span class="hl-5">person</span><span class="hl-0">: </span><span class="hl-5">Person</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">person</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-8">// using primitive types (&quot;boolean&quot;, &quot;double&quot;, &quot;int&quot;, &quot;number&quot;, &quot;object&quot; or &quot;string&quot;)</span><br/><span class="hl-0">@</span><span class="hl-7">POST</span><span class="hl-0">(</span><span class="hl-2">&quot;/plain&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">apiOperation</span><span class="hl-0">({ </span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-2">&quot;add some plain stuff&quot;</span><span class="hl-0">, </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;plain stuff&quot;</span><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiRequest</span><span class="hl-0">({</span><span class="hl-5">type:</span><span class="hl-0"> </span><span class="hl-2">&quot;int&quot;</span><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiResponse</span><span class="hl-0">(</span><span class="hl-10">200</span><span class="hl-0">, {</span><span class="hl-5">type:</span><span class="hl-0"> </span><span class="hl-2">&quot;int&quot;</span><span class="hl-0">})</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">postNumber</span><span class="hl-0">(@</span><span class="hl-5">body</span><span class="hl-0"> </span><span class="hl-5">stuff</span><span class="hl-0">: </span><span class="hl-5">number</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">stuff</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-8">// using array types (&quot;array&quot;, &quot;array-array&quot;, &quot;boolean-array&quot;, &quot;double-array&quot;, &quot;int-array&quot;, &quot;number-array&quot;, &quot;object-array&quot; or &quot;string-array&quot;)</span><br/><span class="hl-0">@</span><span class="hl-7">POST</span><span class="hl-0">(</span><span class="hl-2">&quot;/array&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">apiOperation</span><span class="hl-0">({ </span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-2">&quot;add array&quot;</span><span class="hl-0">, </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;array time&quot;</span><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiRequest</span><span class="hl-0">({</span><span class="hl-5">type:</span><span class="hl-0"> </span><span class="hl-2">&quot;string-array&quot;</span><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiResponse</span><span class="hl-0">(</span><span class="hl-10">200</span><span class="hl-0">, {</span><span class="hl-5">type:</span><span class="hl-0"> </span><span class="hl-2">&quot;string-array&quot;</span><span class="hl-0">})</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">postArray</span><span class="hl-0">(@</span><span class="hl-5">body</span><span class="hl-0"> </span><span class="hl-5">stuff</span><span class="hl-0">: </span><span class="hl-5">string</span><span class="hl-0">[]) {</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">stuff</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-8">// upload/download files</span><br/><span class="hl-0">@</span><span class="hl-7">POST</span><span class="hl-0">(</span><span class="hl-2">&quot;/files&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">apiOperation</span><span class="hl-0">({ </span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-2">&quot;add file&quot;</span><span class="hl-0">, </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;give me a file&quot;</span><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiRequest</span><span class="hl-0">({</span><span class="hl-5">contentType:</span><span class="hl-0"> </span><span class="hl-2">&quot;application/octet-stream&quot;</span><span class="hl-0">, </span><span class="hl-5">type:</span><span class="hl-0"> </span><span class="hl-2">&quot;file&quot;</span><span class="hl-0">}) </span><span class="hl-8">// contentType can be used in any request or response definition, inherits controller or endpoint type by default</span><br/><span class="hl-0">@</span><span class="hl-7">apiResponse</span><span class="hl-0">(</span><span class="hl-10">201</span><span class="hl-0">, {</span><span class="hl-5">contentType:</span><span class="hl-0"> </span><span class="hl-2">&quot;application/octet-stream&quot;</span><span class="hl-0">, </span><span class="hl-5">type:</span><span class="hl-0"> </span><span class="hl-2">&quot;file&quot;</span><span class="hl-0">})</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">postFile</span><span class="hl-0">(@</span><span class="hl-5">rawBody</span><span class="hl-0"> </span><span class="hl-5">file</span><span class="hl-0">: </span><span class="hl-5">Buffer</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-7">sendFile</span><span class="hl-0">(</span><span class="hl-5">file</span><span class="hl-0">)</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-8">// providing custom request/response body example</span><br/><span class="hl-0">@</span><span class="hl-7">POST</span><span class="hl-0">(</span><span class="hl-2">&quot;/custom-info&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">apiOperation</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-2">&quot;add custom stuff&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;go add some custom stuff&quot;</span><br/><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiRequest</span><span class="hl-0">({</span><br/><span class="hl-0">    </span><span class="hl-5">class:</span><span class="hl-0"> </span><span class="hl-5">Person</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">example:</span><span class="hl-0"> </span><span class="hl-2">`{&quot;name&quot;: &quot;some name&quot;, &quot;age&quot;: 22}`</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;Details for a person&quot;</span><br/><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiResponse</span><span class="hl-0">(</span><span class="hl-10">201</span><span class="hl-0">, {</span><br/><span class="hl-0">    </span><span class="hl-5">class:</span><span class="hl-0"> </span><span class="hl-5">Person</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">example:</span><span class="hl-0"> </span><span class="hl-2">`{&quot;name&quot;: &quot;another name&quot;, &quot;age&quot;: 30}`</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;Uploaded person information&quot;</span><br/><span class="hl-0">})</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">postCustomInfo</span><span class="hl-0">(@</span><span class="hl-5">body</span><span class="hl-0"> </span><span class="hl-5">person</span><span class="hl-0">: </span><span class="hl-5">Person</span><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">person</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-8">// no response content, only a status code</span><br/><span class="hl-0">@</span><span class="hl-7">DELETE</span><span class="hl-0">()</span><br/><span class="hl-0">@</span><span class="hl-7">apiOperation</span><span class="hl-0">({</span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-2">&quot;delete stuff&quot;</span><span class="hl-0">, </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;go delete some stuff&quot;</span><span class="hl-0">})</span><br/><span class="hl-0">@</span><span class="hl-7">apiResponse</span><span class="hl-0">(</span><span class="hl-10">204</span><span class="hl-0">)</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-3">delete</span><span class="hl-0">() {</span><br/><span class="hl-0">    </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">response</span><span class="hl-0">.</span><span class="hl-7">status</span><span class="hl-0">(</span><span class="hl-10">204</span><span class="hl-0">).</span><span class="hl-7">send</span><span class="hl-0">(</span><span class="hl-2">&quot;&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">}</span>
</code></pre>
</li>
<li><p>Hide controllers or individual endpoints from the documentation with <code>apiIgnoreController</code> and <code>apiIgnore</code>:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">injectable</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;inversify&quot;</span><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">api</span><span class="hl-0">, </span><span class="hl-5">apiController</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiController</span><span class="hl-0">(</span><span class="hl-2">&quot;/private&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">api</span><span class="hl-0">(</span><span class="hl-2">&quot;Private API&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;You can still annotate these&quot;</span><span class="hl-0">)</span><br/><span class="hl-0">@</span><span class="hl-7">apiIgnoreController</span><span class="hl-0">()</span><br/><span class="hl-0">@</span><span class="hl-7">injectable</span><span class="hl-0">()</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">PrivateController</span><span class="hl-0"> {</span><br/><br/><span class="hl-0">  @</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-0">  @</span><span class="hl-7">apiOperation</span><span class="hl-0">({ </span><span class="hl-5">name:</span><span class="hl-0"> </span><span class="hl-2">&quot;get stuff&quot;</span><span class="hl-0">, </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;go get some stuff&quot;</span><span class="hl-0">})</span><br/><span class="hl-0">  @</span><span class="hl-7">apiIgnore</span><span class="hl-0">() </span><span class="hl-8">// if you didn&#39;t want to ignore the whole controller</span><br/><span class="hl-0">  </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">() {</span><br/><span class="hl-0">      </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-2">&quot;OK&quot;</span><br/><span class="hl-0">  }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>  The class <code>Person</code> is set as the request and response in several of the examples above. To help the framework provide meaningful request and response examples automatically, you must either:</p>
<ol>
<li>Provide a public static <code>example</code> method in your class, which will be called if found when generating an API spec. (recommended)</li>
</ol>
<pre><code class="language-typescript"><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">Person</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-5">name</span><span class="hl-0">: </span><span class="hl-9">string</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-5">age</span><span class="hl-0">: </span><span class="hl-9">number</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-5">roles</span><span class="hl-0">?: </span><span class="hl-9">string</span><span class="hl-0">[]</span><br/><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">static</span><span class="hl-0"> </span><span class="hl-7">example</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">person</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">Person</span><span class="hl-0">()</span><br/><br/><span class="hl-0">        </span><span class="hl-5">person</span><span class="hl-0">.</span><span class="hl-5">name</span><span class="hl-0"> = </span><span class="hl-2">&quot;name&quot;</span><br/><span class="hl-0">        </span><span class="hl-5">person</span><span class="hl-0">.</span><span class="hl-5">age</span><span class="hl-0"> = </span><span class="hl-10">18</span><br/><span class="hl-0">        </span><span class="hl-5">person</span><span class="hl-0">.</span><span class="hl-5">roles</span><span class="hl-0"> = [</span><span class="hl-2">&quot;role1&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;role2&quot;</span><span class="hl-0">, </span><span class="hl-2">&quot;roleN&quot;</span><span class="hl-0">]</span><br/><br/><span class="hl-0">        </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">person</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>  -OR-</p>
<ol start="2">
<li>Populate your instance in it&#39;s constructor with some non null/undefined values.</li>
</ol>
<pre><code class="language-typescript"><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">Person</span><span class="hl-0"> {</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-5">name</span><span class="hl-0">: </span><span class="hl-9">string</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-5">age</span><span class="hl-0">: </span><span class="hl-9">number</span><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-5">roles</span><span class="hl-0">?: </span><span class="hl-9">string</span><span class="hl-0">[]</span><br/><br/><span class="hl-0">    </span><span class="hl-3">public</span><span class="hl-0"> </span><span class="hl-3">constructor</span><span class="hl-0">() {</span><br/><span class="hl-0">        </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">name</span><span class="hl-0"> = </span><span class="hl-2">&quot;&quot;</span><br/><span class="hl-0">        </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">age</span><span class="hl-0"> = </span><span class="hl-10">0</span><br/><span class="hl-0">        </span><span class="hl-3">this</span><span class="hl-0">.</span><span class="hl-5">roles</span><span class="hl-0"> = []</span><br/><span class="hl-0">    }</span><br/><span class="hl-0">}</span>
</code></pre>
<p>  <em>This is required because object properties are not defined until a value is assigned, which makes any sort of reflection impossible.</em></p>
</li>
<li><p>Describe the path, query and header parameters consumed by your endpoints:</p>
<pre><code class="language-typescript"><span class="hl-8">// the below uses the same options used to describe api requests and responses</span><br/><span class="hl-0">@</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">get</span><span class="hl-0">(</span><br/><span class="hl-0">    @</span><span class="hl-7">queryParam</span><span class="hl-0">(</span><span class="hl-2">&quot;param&quot;</span><span class="hl-0">, { </span><span class="hl-5">description:</span><span class="hl-0"> </span><span class="hl-2">&quot;whatever you like&quot;</span><span class="hl-0">, </span><span class="hl-5">type:</span><span class="hl-0"> </span><span class="hl-2">&quot;int&quot;</span><span class="hl-0"> }) </span><span class="hl-5">param</span><span class="hl-0">: </span><span class="hl-5">string</span><br/><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-8">// remember, defining a type does not affect the parameter type, will always be a string</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">param</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-8">// You can mark query and header params as required or not,</span><br/><span class="hl-8">// path parameters are always set to required.</span><br/><span class="hl-0">@</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">getAnotherThing</span><span class="hl-0">(</span><br/><span class="hl-0">    @</span><span class="hl-7">header</span><span class="hl-0">(</span><span class="hl-2">&quot;x-param&quot;</span><span class="hl-0">, { </span><span class="hl-5">required:</span><span class="hl-0"> </span><span class="hl-3">true</span><span class="hl-0"> }) </span><span class="hl-5">param</span><span class="hl-0">: </span><span class="hl-5">string</span><br/><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-8">// remember, defining required will not perform any validation, null/undefined will</span><br/><span class="hl-0">    </span><span class="hl-8">// still be passed if the parameter is missing from the request</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">param</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-8">// When expecting an object/array, you can pass in the</span><br/><span class="hl-8">// expected formatting style.</span><br/><span class="hl-8">//</span><br/><span class="hl-8">// For help with the `style` field, see: https://swagger.io/docs/specification/serialization/</span><br/><span class="hl-0">@</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">getAnotherThing</span><span class="hl-0">(</span><br/><span class="hl-0">    @</span><span class="hl-7">queryParam</span><span class="hl-0">(</span><span class="hl-2">&quot;param&quot;</span><span class="hl-0">, { </span><span class="hl-5">type:</span><span class="hl-0"> </span><span class="hl-2">&quot;int-array&quot;</span><span class="hl-0">, </span><span class="hl-5">style:</span><span class="hl-0"> </span><span class="hl-2">&quot;pipeDelimited&quot;</span><span class="hl-0">, </span><span class="hl-5">explode:</span><span class="hl-0"> </span><span class="hl-3">false</span><span class="hl-0"> }) </span><span class="hl-5">param</span><span class="hl-0">: </span><span class="hl-5">string</span><br/><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-8">// we would expect param to be passed in the query string as &#39;param=1|2|3|4&#39;</span><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">param</span><br/><span class="hl-0">}</span><br/><br/><span class="hl-8">// you can specify a content type if the string is expected to be JSON etc.</span><br/><span class="hl-0">@</span><span class="hl-7">GET</span><span class="hl-0">()</span><br/><span class="hl-5">public</span><span class="hl-0"> </span><span class="hl-7">getHeaderTest</span><span class="hl-0">(</span><br/><span class="hl-0">    @</span><span class="hl-7">header</span><span class="hl-0">(</span><span class="hl-2">&quot;x-custom-header&quot;</span><span class="hl-0">, { </span><span class="hl-5">class:</span><span class="hl-0"> </span><span class="hl-5">Person</span><span class="hl-0">, </span><span class="hl-5">contentType:</span><span class="hl-0"> </span><span class="hl-2">&quot;application/json&quot;</span><span class="hl-0"> }) </span><span class="hl-5">customHeader</span><span class="hl-0">: </span><span class="hl-5">string</span><br/><span class="hl-0">) {</span><br/><span class="hl-0">    </span><span class="hl-3">let</span><span class="hl-0"> </span><span class="hl-5">person</span><span class="hl-0">: </span><span class="hl-9">Person</span><span class="hl-0"> = </span><span class="hl-9">JSON</span><span class="hl-0">.</span><span class="hl-7">parse</span><span class="hl-0">(</span><span class="hl-5">customHeader</span><span class="hl-0">)</span><br/><br/><span class="hl-0">    </span><span class="hl-4">return</span><span class="hl-0"> </span><span class="hl-5">person</span><br/><span class="hl-0">}</span>
</code></pre>
<p>  <em>Path parameters support the following styles: simple, label, matrix</em></p>
<p>  <em>Header parameters only support the &#39;simple&#39; style</em></p>
<p>  <em>Note: Setting a content type for your parameter is supported, but due to an outstanding issue, these parameters will not display in Swagger UI / Editor, see: <a href="https://github.com/swagger-api/swagger-ui/issues/4442">https://github.com/swagger-api/swagger-ui/issues/4442</a></em></p>
</li>
<li><p>Add security schemes to your specification (other than Basic auth, this is automatically detected) using an <code>apiSecurity</code> decorator on your authentication filter:</p>
<pre><code class="language-typescript"><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">apiSecurity</span><span class="hl-0">, </span><span class="hl-5">IAuthFilter</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;ts-lambda-api&quot;</span><br/><br/><span class="hl-4">import</span><span class="hl-0"> { </span><span class="hl-5">User</span><span class="hl-0"> } </span><span class="hl-4">from</span><span class="hl-0"> </span><span class="hl-2">&quot;./User&quot;</span><br/><br/><span class="hl-0">@</span><span class="hl-7">apiSecurity</span><span class="hl-0">(</span><span class="hl-2">&quot;bearerAuth&quot;</span><span class="hl-0">, {</span><br/><span class="hl-0">    </span><span class="hl-5">type:</span><span class="hl-0"> </span><span class="hl-2">&quot;http&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">scheme:</span><span class="hl-0"> </span><span class="hl-2">&quot;bearer&quot;</span><span class="hl-0">,</span><br/><span class="hl-0">    </span><span class="hl-5">bearerFormat:</span><span class="hl-0"> </span><span class="hl-2">&quot;JWT&quot;</span><br/><span class="hl-0">})</span><br/><span class="hl-4">export</span><span class="hl-0"> </span><span class="hl-3">class</span><span class="hl-0"> </span><span class="hl-9">CustomAuthFilter</span><span class="hl-0"> </span><span class="hl-3">implements</span><span class="hl-0"> </span><span class="hl-9">IAuthFilter</span><span class="hl-0">&lt;</span><span class="hl-9">string</span><span class="hl-0">, </span><span class="hl-9">User</span><span class="hl-0">&gt; {</span><br/><span class="hl-0">    </span><span class="hl-8">// ... implementation ...</span><br/><span class="hl-0">}</span>
</code></pre>
<p>  This decorator uses the <code>SecuritySchemeObject</code> class from the <code>openapi3-ts</code> library to describe the security scheme in place. See the source for more information on using this class: <a href="https://github.com/metadevpro/openapi3-ts/blob/ab997f12a63fa215e3b0c08cc293429b97ce0a44/src/model/OpenApi.ts#L314">SecuritySchemeObject source</a></p>
</li>
</ul>

<a href="#yaml-support" id="yaml-support" style="color: inherit; text-decoration: none;">
  <h3><a id="open-api-yaml"></a>YAML Support</h3>
</a>
<p>For <code>YAML</code> specification support, you need to install the following packages in your project:</p>
<pre><code class="language-bash"><span class="hl-0">npm install js-yaml</span><br/><span class="hl-0">npm install -D @types/js-yaml</span>
</code></pre>

<a href="#authentication" id="authentication" style="color: inherit; text-decoration: none;">
  <h3><a id="open-api-auth"></a>Authentication</h3>
</a>
<p>By default the OpenAPI endpoints do not require authentication. If you wish to apply auth filters when a request is made for a spec, set the <code>useAuthentication</code> key in the <code>openApi</code> config:</p>
<pre><code class="language-typescript"><span class="hl-8">// build controllers path...</span><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">appConfig</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">AppConfig</span><span class="hl-0">()</span><br/><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">base</span><span class="hl-0"> = </span><span class="hl-2">&quot;/api/v1&quot;</span><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">version</span><span class="hl-0"> = </span><span class="hl-2">&quot;v1&quot;</span><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">openApi</span><span class="hl-0">.</span><span class="hl-5">enabled</span><span class="hl-0"> = </span><span class="hl-3">true</span><br/><span class="hl-5">appConfig</span><span class="hl-0">.</span><span class="hl-5">openApi</span><span class="hl-0">.</span><span class="hl-5">useAuthentication</span><span class="hl-0"> = </span><span class="hl-3">true</span><br/><br/><span class="hl-3">const</span><span class="hl-0"> </span><span class="hl-6">app</span><span class="hl-0"> = </span><span class="hl-3">new</span><span class="hl-0"> </span><span class="hl-7">ApiLambdaApp</span><span class="hl-0">(</span><span class="hl-5">controllersPath</span><span class="hl-0">, </span><span class="hl-5">appConfig</span><span class="hl-0">)</span><br/><span class="hl-8">// export handler</span>
</code></pre>
<hr>

<a href="#testing" id="testing" style="color: inherit; text-decoration: none;">
  <h2><a id="testing"></a>Testing</h2>
</a>
<hr>
<p>For local dev testing and integration with acceptance tests see the <a href="https://www.npmjs.com/package/ts-lambda-api-local">ts-lambda-api-local</a> package which enables hosting your API using express as a local HTTP server.</p>
<p>Check out this project&#39;s dev dependencies to see what is required to test API code. The <code>tests</code> directory of this repo contains extensive acceptance tests which will show you how to build mock requests and invoke your API endpoints programmatically.</p>
</div></div><div class="col-4 col-menu menu-sticky-wrap menu-highlight"><nav class="tsd-navigation primary"><ul><li class="current"><a href="modules.html">Exports</a></li></ul></nav><nav class="tsd-navigation secondary menu-sticky"><ul><li class="tsd-kind-enum"><a href="enums/LogLevel.html" class="tsd-kind-icon">Log<wbr/>Level</a></li><li class="tsd-kind-class"><a href="classes/ApiApp.html" class="tsd-kind-icon">Api<wbr/>App</a></li><li class="tsd-kind-class"><a href="classes/ApiError.html" class="tsd-kind-icon">Api<wbr/>Error</a></li><li class="tsd-kind-class"><a href="classes/ApiLambdaApp.html" class="tsd-kind-icon">Api<wbr/>Lambda<wbr/>App</a></li><li class="tsd-kind-class"><a href="classes/ApiRequest.html" class="tsd-kind-icon">Api<wbr/>Request</a></li><li class="tsd-kind-class"><a href="classes/ApiResponse.html" class="tsd-kind-icon">Api<wbr/>Response</a></li><li class="tsd-kind-class"><a href="classes/AppConfig.html" class="tsd-kind-icon">App<wbr/>Config</a></li><li class="tsd-kind-class"><a href="classes/BasicAuth.html" class="tsd-kind-icon">Basic<wbr/>Auth</a></li><li class="tsd-kind-class tsd-has-type-parameter"><a href="classes/BasicAuthFilter.html" class="tsd-kind-icon">Basic<wbr/>Auth<wbr/>Filter</a></li><li class="tsd-kind-class"><a href="classes/Controller.html" class="tsd-kind-icon">Controller</a></li><li class="tsd-kind-class"><a href="classes/ErrorInterceptor.html" class="tsd-kind-icon">Error<wbr/>Interceptor</a></li><li class="tsd-kind-class"><a href="classes/LogFactory.html" class="tsd-kind-icon">Log<wbr/>Factory</a></li><li class="tsd-kind-class"><a href="classes/MiddlewareRegistry.html" class="tsd-kind-icon">Middleware<wbr/>Registry</a></li><li class="tsd-kind-class"><a href="classes/OpenApiConfig.html" class="tsd-kind-icon">Open<wbr/>Api<wbr/>Config</a></li><li class="tsd-kind-class"><a href="classes/Principal.html" class="tsd-kind-icon">Principal</a></li><li class="tsd-kind-class"><a href="classes/RequestBuilder.html" class="tsd-kind-icon">Request<wbr/>Builder</a></li><li class="tsd-kind-class"><a href="classes/Server.html" class="tsd-kind-icon">Server</a></li><li class="tsd-kind-class"><a href="classes/ServerLoggerConfig.html" class="tsd-kind-icon">Server<wbr/>Logger<wbr/>Config</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/IAuthFilter.html" class="tsd-kind-icon">IAuth<wbr/>Filter</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/IAuthorizer.html" class="tsd-kind-icon">IAuthorizer</a></li><li class="tsd-kind-interface tsd-has-type-parameter"><a href="interfaces/IDictionary.html" class="tsd-kind-icon">IDictionary</a></li><li class="tsd-kind-interface"><a href="interfaces/ILogger.html" class="tsd-kind-icon">ILogger</a></li><li class="tsd-kind-type-alias"><a href="modules.html#JsonPatch" class="tsd-kind-icon">Json<wbr/>Patch</a></li><li class="tsd-kind-type-alias"><a href="modules.html#LogFormat" class="tsd-kind-icon">Log<wbr/>Format</a></li><li class="tsd-kind-function"><a href="modules.html#DELETE" class="tsd-kind-icon">DELETE</a></li><li class="tsd-kind-function"><a href="modules.html#GET" class="tsd-kind-icon">GET</a></li><li class="tsd-kind-function"><a href="modules.html#PATCH" class="tsd-kind-icon">PATCH</a></li><li class="tsd-kind-function"><a href="modules.html#POST" class="tsd-kind-icon">POST</a></li><li class="tsd-kind-function"><a href="modules.html#PUT" class="tsd-kind-icon">PUT</a></li><li class="tsd-kind-function"><a href="modules.html#api" class="tsd-kind-icon">api</a></li><li class="tsd-kind-function"><a href="modules.html#apiController" class="tsd-kind-icon">api<wbr/>Controller</a></li><li class="tsd-kind-function"><a href="modules.html#apiIgnore" class="tsd-kind-icon">api<wbr/>Ignore</a></li><li class="tsd-kind-function"><a href="modules.html#apiIgnoreController" class="tsd-kind-icon">api<wbr/>Ignore<wbr/>Controller</a></li><li class="tsd-kind-function"><a href="modules.html#apiOperation" class="tsd-kind-icon">api<wbr/>Operation</a></li><li class="tsd-kind-function"><a href="modules.html#apiRequest" class="tsd-kind-icon">api<wbr/>Request</a></li><li class="tsd-kind-function"><a href="modules.html#apiResponse" class="tsd-kind-icon">api<wbr/>Response</a></li><li class="tsd-kind-function"><a href="modules.html#apiSecurity" class="tsd-kind-icon">api<wbr/>Security</a></li><li class="tsd-kind-function"><a href="modules.html#body" class="tsd-kind-icon">body</a></li><li class="tsd-kind-function"><a href="modules.html#consumes" class="tsd-kind-icon">consumes</a></li><li class="tsd-kind-function"><a href="modules.html#controllerConsumes" class="tsd-kind-icon">controller<wbr/>Consumes</a></li><li class="tsd-kind-function"><a href="modules.html#controllerErrorInterceptor" class="tsd-kind-icon">controller<wbr/>Error<wbr/>Interceptor</a></li><li class="tsd-kind-function"><a href="modules.html#controllerNoAuth" class="tsd-kind-icon">controller<wbr/>No<wbr/>Auth</a></li><li class="tsd-kind-function"><a href="modules.html#controllerProduces" class="tsd-kind-icon">controller<wbr/>Produces</a></li><li class="tsd-kind-function"><a href="modules.html#controllerRolesAllowed" class="tsd-kind-icon">controller<wbr/>Roles<wbr/>Allowed</a></li><li class="tsd-kind-function"><a href="modules.html#errorInterceptor" class="tsd-kind-icon">error<wbr/>Interceptor</a></li><li class="tsd-kind-function"><a href="modules.html#header" class="tsd-kind-icon">header</a></li><li class="tsd-kind-function"><a href="modules.html#noAuth" class="tsd-kind-icon">no<wbr/>Auth</a></li><li class="tsd-kind-function"><a href="modules.html#pathParam" class="tsd-kind-icon">path<wbr/>Param</a></li><li class="tsd-kind-function"><a href="modules.html#principal" class="tsd-kind-icon">principal</a></li><li class="tsd-kind-function"><a href="modules.html#produces" class="tsd-kind-icon">produces</a></li><li class="tsd-kind-function"><a href="modules.html#queryParam" class="tsd-kind-icon">query<wbr/>Param</a></li><li class="tsd-kind-function"><a href="modules.html#rawBody" class="tsd-kind-icon">raw<wbr/>Body</a></li><li class="tsd-kind-function"><a href="modules.html#request" class="tsd-kind-icon">request</a></li><li class="tsd-kind-function"><a href="modules.html#response" class="tsd-kind-icon">response</a></li><li class="tsd-kind-function"><a href="modules.html#rolesAllowed" class="tsd-kind-icon">roles<wbr/>Allowed</a></li><li class="tsd-kind-function"><a href="modules.html#timed" class="tsd-kind-icon">timed</a></li></ul></nav></div></div></div><footer class="with-border-bottom"><div class="container"><h2>Legend</h2><div class="tsd-legend-group"><ul class="tsd-legend"><li class="tsd-kind-constructor tsd-parent-kind-class"><span class="tsd-kind-icon">Constructor</span></li><li class="tsd-kind-property tsd-parent-kind-class"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-class"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-interface"><span class="tsd-kind-icon">Property</span></li><li class="tsd-kind-method tsd-parent-kind-interface"><span class="tsd-kind-icon">Method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-inherited"><span class="tsd-kind-icon">Inherited method</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-property tsd-parent-kind-class tsd-is-protected"><span class="tsd-kind-icon">Protected property</span></li></ul><ul class="tsd-legend"><li class="tsd-kind-method tsd-parent-kind-class tsd-is-static"><span class="tsd-kind-icon">Static method</span></li></ul></div><h2>Settings</h2><p>Theme <select id="theme"><option value="os">OS</option><option value="light">Light</option><option value="dark">Dark</option></select></p></div></footer><div class="container tsd-generator"><p>Generated using <a href="https://typedoc.org/" target="_blank">TypeDoc</a></p></div><div class="overlay"></div><script src="assets/main.js"></script></body></html>